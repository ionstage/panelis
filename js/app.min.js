!function(t){"use strict";var o={},e=t.window,n=t.document;o.randomBoolean=function(){return Math.random()<.5},o.isEqual=function(t,o){if(t===o)return!0;if(Object.keys(t).length!==Object.keys(o).length)return!1;for(var e in t)if(t[e]!==o[e])return!1;return!0},o.inherits=function(t,o){return t.super_=o,t.prototype=Object.create(o.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),t},o.uniq=function(t){for(var e=[],n=0,r=t.length;r>n;n++){for(var i=!0,l=t[n],a=0,c=e.length;c>a;a++){var s=e[a];o.isEqual(l,s)&&(i=!1)}i&&e.push(l)}return e},o.supportsTouch=n&&"createTouch"in n||!1,o.supportsTransitionEnd=function(){if(!n)return!1;var t=n.createElement("div");return"undefined"!=typeof t.style.transition}(),o.windowAspectRatio=function(){return e.innerWidth/e.innerHeight},o.addClass=function(t,o){t.setAttribute("class",t.getAttribute("class")+" "+o)},o.replaceClass=function(t,o,e){var n=t.getAttribute("class").replace(o,e);t.setAttribute("class",n)},o.$globalToLocal=function(t){var o=app.view.className,e=n.querySelector("."+o),r=e.createSVGPoint();return r.x=t.x,r.y=t.y,r.matrixTransform(e.getScreenCTM().inverse())},o.$createPanelView=function(t){var o=app.panelView;return o({panel:m.prop(t.panel),x:m.prop(t.x),y:m.prop(t.y),width:m.prop(t.width)})},"undefined"!=typeof module&&module.exports?module.exports=o:t.util=o}(this),function(t){"use strict";var o=t.app||{},e=t.m||require("mithril"),n=t.util||require("../util.js"),r=n.randomBoolean,i=function(t){this.color=e.prop(t.color||i.COLOR_BROWN),this.jointTop=e.prop(t.jointTop||!1),this.jointRight=e.prop(t.jointRight||!1),this.jointBottom=e.prop(t.jointBottom||!1),this.jointLeft=e.prop(t.jointLeft||!1),this.isFixed=e.prop(t.isFixed||!1)};i.prototype.mixColor=function(t){var o=this.color();t===i.COLOR_WHITE?o===i.COLOR_BLACK?this.color(i.COLOR_GRAY):o===i.COLOR_GRAY&&this.color(i.COLOR_WHITE):t===i.COLOR_BLACK&&(o===i.COLOR_WHITE?this.color(i.COLOR_GRAY):o===i.COLOR_GRAY&&this.color(i.COLOR_BLACK))},i.prototype.eachJoint=function(t){this.jointTop()&&t(i.JOINT_TOP),this.jointRight()&&t(i.JOINT_RIGHT),this.jointBottom()&&t(i.JOINT_BOTTOM),this.jointLeft()&&t(i.JOINT_LEFT)},i.prototype.rotate=function(){var t=this.jointTop();this.jointTop(this.jointLeft()),this.jointLeft(this.jointBottom()),this.jointBottom(this.jointRight()),this.jointRight(t)},i.prototype.resetRotation=function(){for(var t=0;4>t;t++){for(var o=this.jointTop(),e=this.jointRight(),n=this.jointBottom(),r=this.jointLeft(),i=0,a=l.length;a>i;i++){var c=l[i];if(c.jointTop()===o&&c.jointRight()===e&&c.jointBottom()===n&&c.jointLeft()===r)return}this.rotate()}},i.prototype.clone=function(){return new i({color:this.color(),jointTop:this.jointTop(),jointRight:this.jointRight(),jointBottom:this.jointBottom(),jointLeft:this.jointLeft(),isFixed:this.isFixed()})},i.sample=function(t,o){var e,n,a,c;if(o)e=o===i.JOINT_TOP?r():!1,n=o===i.JOINT_RIGHT?r():!1,a=o===i.JOINT_BOTTOM?r():!1,c=o===i.JOINT_LEFT?r():!1;else{var s=l[Math.floor(Math.random()*l.length)];e=s.jointTop(),n=s.jointRight(),a=s.jointBottom(),c=s.jointLeft()}return new i({color:t,jointTop:e,jointRight:n,jointBottom:a,jointLeft:c})},i.COLOR_BROWN="brown",i.COLOR_WHITE="white",i.COLOR_BLACK="black",i.COLOR_GRAY="gray",i.JOINT_TOP="top",i.JOINT_RIGHT="right",i.JOINT_BOTTOM="bottom",i.JOINT_LEFT="left";var l=[new i({jointTop:!0}),new i({jointTop:!0,jointRight:!0}),new i({jointTop:!0,jointBottom:!0}),new i({jointTop:!0,jointRight:!0,jointBottom:!0}),new i({jointTop:!0,jointRight:!0,jointBottom:!0,jointLeft:!0})];o.Panel=i,t.app=o}(this),function(t){"use strict";var o=t.app||{},e=t.m||require("mithril"),n=t.util||require("../util.js"),r=o.Panel||require("./panel.js").app.Panel,i=n.isEqual,l=n.uniq,a=function(t){this.panels=e.prop([[]]),this.rowLength=e.prop(t.rowLength||8),this.colLength=e.prop(t.colLength||8),this.reset()};a.prototype.panel=function(t,o,e){var n=this.panels();return"undefined"==typeof e?n[t][o]:void(n[t][o]=e)},a.prototype.fix=function(t,o){var e=this.panel(t,o);e.isFixed(!0)},a.prototype.canFix=function(t,o,e){var n=this.panels();if(0>=t||t>=n.length-1)return!1;if(0>=o||o>=n[0].length-1)return!1;var r=this.panel(t,o)||e,i=this.panel(t-1,o);if(r.jointTop()&&(!i||!i.jointBottom()))return!1;var l=this.panel(t,o+1);if(r.jointRight()&&(!l||!l.jointLeft()))return!1;var a=this.panel(t+1,o);if(r.jointBottom()&&(!a||!a.jointTop()))return!1;var c=this.panel(t,o-1);return!r.jointLeft()||c&&c.jointRight()?!0:!1},a.prototype.canJoint=function(t,o,e){var n=this.panels();if(0>=t||t>=n.length-1)return!1;if(0>=o||o>=n[0].length-1)return!1;var r=this.panel(t,o)||e,i=this.panel(t-1,o);if(i&&(!i.jointBottom()&&r.jointTop()||i.jointBottom()&&!r.jointTop()))return!1;var l=this.panel(t,o+1);if(l&&(!l.jointLeft()&&r.jointRight()||l.jointLeft()&&!r.jointRight()))return!1;var a=this.panel(t+1,o);if(a&&(!a.jointTop()&&r.jointBottom()||a.jointTop()&&!r.jointBottom()))return!1;var c=this.panel(t,o-1);return c&&(!c.jointRight()&&r.jointLeft()||c.jointRight()&&!r.jointLeft())?!1:!0},a.prototype.canJointAnyPosition=function(t){var o=this.panels(),e=this.rowLength(),n=this.colLength();if(0===e||0===n)return!1;if(Array.isArray(t))for(var r=0,i=t.length;i>r;r++){var l=t[r];if(l&&this.canJointAnyPosition(l))return!0}else for(var l=t.clone(),a=0;e>a;a++)for(var c=0;n>c;c++)if(!o[a][c])for(var s=0;4>s;s++){if(this.canJoint(a,c,l))return!0;l.rotate()}return!1},a.prototype.isJointed=function(t,o,e,n){return this.panel(t,o)&&this.panel(e,n)?t===e+1&&o===n&&this.panel(t,o).jointTop()&&this.panel(e,n).jointBottom()?!0:t===e&&o===n-1&&this.panel(t,o).jointRight()&&this.panel(e,n).jointLeft()?!0:t===e-1&&o===n&&this.panel(t,o).jointBottom()&&this.panel(e,n).jointTop()?!0:t===e&&o===n+1&&this.panel(t,o).jointLeft()&&this.panel(e,n).jointRight()?!0:!1:!1},a.prototype.releaseColor=function(t,o){var e=this.panel(t,o),n=e.color(),i=!1,l=this.panel(t-1,o);l&&!l.isFixed()&&l.color()!==n&&l.color()!==r.COLOR_BROWN&&l.jointBottom()&&e.jointTop()&&(l.mixColor(n),i=!0);var a=this.panel(t,o+1);a&&!a.isFixed()&&a.color()!==n&&a.color()!==r.COLOR_BROWN&&a.jointLeft()&&e.jointRight()&&(a.mixColor(n),i=!0);var c=this.panel(t+1,o);c&&!c.isFixed()&&c.color()!==n&&c.color()!==r.COLOR_BROWN&&c.jointTop()&&e.jointBottom()&&(c.mixColor(n),i=!0);var s=this.panel(t,o-1);return s&&!s.isFixed()&&s.color()!==n&&s.color()!==r.COLOR_BROWN&&s.jointRight()&&e.jointLeft()&&(s.mixColor(n),i=!0),i},a.prototype.calcChain=function(t,o){var e=this.panel(t,o);if(!e)return[];var n=e.color(),r=[[{row:t,col:o}]],a=[{row:t,col:o}],c=this;return function s(t){for(var o=r[t],e=[],h=0,p=o.length;p>h;h++){var u=o[h];c.isJointed(u.row,u.col,u.row-1,u.col)&&c.panel(u.row-1,u.col).color()===n&&e.push({row:u.row-1,col:u.col}),c.isJointed(u.row,u.col,u.row,u.col+1)&&c.panel(u.row,u.col+1).color()===n&&e.push({row:u.row,col:u.col+1}),c.isJointed(u.row,u.col,u.row+1,u.col)&&c.panel(u.row+1,u.col).color()===n&&e.push({row:u.row+1,col:u.col}),c.isJointed(u.row,u.col,u.row,u.col-1)&&c.panel(u.row,u.col-1).color()===n&&e.push({row:u.row,col:u.col-1})}e=l(e).filter(function(t){for(var o=0,e=a.length;e>o;o++){var n=a[o];if(i(t,n))return!1}return!0}),Array.prototype.push.apply(a,e),e.length>0&&(r[t+1]=e,s(t+1))}(0),r},a.prototype.reset=function(){for(var t=this.panels(),o=this.rowLength(),e=this.colLength(),n=0;o>n;n++){t[n]=[];for(var r=0;e>r;r++)t[n][r]=null}},a.prototype.randomEdge=function(){var t=this.panels(),o=this.rowLength(),e=this.colLength();t[0][0]=new r({color:r.COLOR_BROWN}),t[0][e-1]=new r({color:r.COLOR_BROWN}),t[o-1][0]=new r({color:r.COLOR_BROWN}),t[o-1][e-1]=new r({color:r.COLOR_BROWN});for(var n=1;e-1>n;n++)t[0][n]=r.sample(r.COLOR_BROWN,r.JOINT_BOTTOM);for(var i=1;o-1>i;i++)t[i][e-1]=r.sample(r.COLOR_BROWN,r.JOINT_LEFT);for(var n=1;e-1>n;n++)t[o-1][n]=r.sample(r.COLOR_BROWN,r.JOINT_TOP);for(var i=1;o-1>i;i++)t[i][0]=r.sample(r.COLOR_BROWN,r.JOINT_RIGHT)},o.Tile=a,t.app=o}(this),function(t){"use strict";var o=t.app||{},e=t.m||require("mithril"),n=function(t){this.red=e.prop(t.red||0),this.yellow=e.prop(t.yellow||0),this.green=e.prop(t.green||0)};n.prototype.add=function(t,o){this[t](this[t]()+o)},n.prototype.reset=function(){this.red(0),this.yellow(0),this.green(0)},n.prototype.total=function(){return 100*this.red()+50*this.yellow()+300*this.green()},n.COLOR_RED="red",n.COLOR_YELLOW="yellow",n.COLOR_GREEN="green",o.Score=n,t.app=o}(this),function(t){"use strict";var o=t.app||{},e=t.m,n=o.Panel,r=o.Tile,i=o.Score,l=function(){var t=function(){};this.tile=e.prop(new r({rowLength:8,colLength:8})),this.panelWidth=e.prop(72),this.scoreColors=e.prop([]),this.onscorechange=t,this.onscoreanimationend=t};l.prototype.panels=function(){return this.tile().panels()},l.prototype.rowLength=function(){return this.tile().rowLength()},l.prototype.colLength=function(){return this.tile().colLength()},l.prototype.panel=function(t,o,e){this.tile().panel(t,o,e)},l.prototype.canJoint=function(t,o,e){return this.tile().canJoint(t,o,e)},l.prototype.canJointAnyPosition=function(t){return this.tile().canJointAnyPosition(t)},l.prototype.reset=function(){var t=this.tile();t.reset(),t.randomEdge()},l.prototype.startScoreAnimation=function(t,o){var n=this,r=[s,h,p,f];setTimeout(function(){!function i(l){var a=r[l];if(!a)return void n.onscoreanimationend();var s=a(n,t,o,r);s&&e.redraw(!0),setTimeout(function(){e.redraw(!0),i(l+1),c(n)},s?500:0)}(0)},250)};var a=function(t,o){t.scoreColors().push(o)},c=function(t){t.scoreColors([])},s=function(t,o,e){var n=t.tile();return n.canFix(o,e)?(n.fix(o,e),a(t,{row:o,col:e,color:i.COLOR_GREEN}),t.onscorechange({red:0,yellow:0,green:1}),!0):!1},h=function(t,o,e){return t.tile().releaseColor(o,e)},p=function(t,o,e){var n=!1,r={red:0,yellow:0,green:0};return n=u(t,o,e,o-1,e,r)||n,n=u(t,o,e,o,e+1,r)||n,n=u(t,o,e,o+1,e,r)||n,n=u(t,o,e,o,e-1,r)||n,t.onscorechange(r),n},u=function(t,o,e,r,l,c){var s=t.tile(),h=s.panel(r,l);return h&&s.isJointed(o,e,r,l)?h.color()===n.COLOR_BROWN?!1:!s.canFix(r,l)||h.isFixed()?!1:(h.color()===n.COLOR_GRAY?(s.panel(r,l,null),a(t,{row:o,col:e,color:i.COLOR_RED}),c.red+=1):(s.fix(r,l),a(t,{row:r,col:l,color:i.COLOR_GREEN}),c.green+=1),!0):!1},f=function(t,o,e,n){var r=t.tile(),l=r.calcChain(o,e);if(l.length<2)return!1;var c=l.map(function(o){return function(){return o.forEach(function(o){a(t,{row:o.row,col:o.col,color:i.COLOR_YELLOW}),t.onscorechange({red:0,yellow:1,green:0})}),!0}});return Array.prototype.push.apply(n,c),!1};o.TileController=l,t.app=o}(this),function(t){"use strict";var o=t.app||{},e=t.m,n=t.util,r=o.TileController,i=n.inherits,l=i(function(){l.super_.call(this),this.selectedPanel=e.prop(null),this.selectedPosition=e.prop(null)},r);l.prototype.clearSelection=function(){this.selectedPanel(null),this.selectedPosition(null)},l.prototype.dispatchEvent=function(t){var o=this.tile(),n=this.selectedPanel(),r=this.selectedPosition();switch(t.type){case"select":if(!n||r)break;var i=t.row,l=t.col;if(o.panel(i,l))break;this.selectedPosition({row:i,col:l}),e.redraw(!0);break;case"rotationend":if(!n)break;n.rotate(),e.redraw(!0)}},o.ActionTileController=l,t.app=o}(this),function(t){"use strict";var o=t.app||{},e=t.m,n=t.util,r=o.Panel,i=o.Score,l=n.supportsTouch,a=n.windowAspectRatio,c=function(t){var o=function(){};this.color=e.prop(t.color),this.active=e.prop(!1),this.panels=s(),this.selectedPanel=e.prop(null),this.score=e.prop(new i({red:0,yellow:0,green:0})),this.panelWidth=e.prop(72),this.onok=o,this.onback=o,this.onselect=o,this.onlayoutchange=o};c.prototype.supplyPanel=function(){for(var t=this.color(),o=this.panels(),e=(this.layout(),0),n=o.length;n>e;e++)if(!o[e]){var i=r.sample(t);this.resetRotation(i),o[e]=i}},c.prototype.selectedIndex=function(){for(var t=this.panels(),o=this.selectedPanel(),e=0,n=t.length;n>e;e++)if(t[e]===o)return e;return-1},c.prototype.removeSelectedPanel=function(){this.panels()[this.selectedIndex()]=null,this.selectedPanel(null)},c.prototype.resetRotation=function(t){t.resetRotation(),this.layout()===c.LAYOUT_HORIZONTAL_INVERSE&&(t.rotate(),t.rotate())},c.prototype.addScore=function(t,o){this.score().add(t,o)},c.prototype.resetScore=function(){this.score().reset()},c.prototype.totalScore=function(){return this.score().total()},c.prototype.layout=function(){return a()>=1?c.LAYOUT_VERTICAL:l&&this.color()===r.COLOR_BLACK?c.LAYOUT_HORIZONTAL_INVERSE:c.LAYOUT_HORIZONTAL},c.prototype.dispatchEvent=function(t){{var o=this.active(),n=this.panels(),r=this.selectedPanel();this.layout()}switch(t.type){case"ok":if(!o||!r)break;this.onok();break;case"back":if(!o||!r)break;this.resetRotation(r),this.selectedPanel(null),this.onback();break;case"select":if(!o||r)break;var i=n[t.selectedIndex];this.selectedPanel(i),e.redraw(!0),this.onselect({panel:i});break;case"layoutchange":for(var l=0,a=n.length;a>l;l++){var i=n[l];i&&i!==r&&this.resetRotation(i)}this.onlayoutchange(),setTimeout(e.redraw,0)}},c.LAYOUT_VERTICAL="vertical",c.LAYOUT_HORIZONTAL="horizontal",c.LAYOUT_HORIZONTAL_INVERSE="horizontal_inverse";var s=function(){var t=e.prop([null,null,null]);return function(o){if("undefined"==typeof o)return t();for(var e=(this.layout(),0),n=o.length;n>e;e++){var r=o[e];r&&this.resetRotation(r)}t(o)}};o.ControlBoardController=c,t.app=o}(this),function(t){"use strict";var o=t.app||{},e=t.m,n=o.Panel,r=o.Score,i=function(t){this.turnPlayerColor=e.prop(t.turnPlayerColor),this.actionTileController=e.prop(t.actionTileController),this.whiteControlBoardController=e.prop(t.whiteControlBoardController),this.blackControlBoardController=e.prop(t.blackControlBoardController)};i.prototype.start=function(){s(this),h(this),p(this)};var l=function(t){var o=t.turnPlayerColor();return o===n.COLOR_WHITE?t.whiteControlBoardController():o===n.COLOR_BLACK?t.blackControlBoardController():null},a=function(t){var o=t.turnPlayerColor();return o===n.COLOR_WHITE?t.blackControlBoardController():o===n.COLOR_BLACK?t.whiteControlBoardController():null},c=function(t){var o=t.turnPlayerColor();o===n.COLOR_WHITE?t.turnPlayerColor(n.COLOR_BLACK):o===n.COLOR_BLACK&&t.turnPlayerColor(n.COLOR_WHITE)},s=function(t){var o=t.actionTileController(),e=t.whiteControlBoardController(),n=t.blackControlBoardController();o.onscorechange=O.bind(t),o.onscoreanimationend=T.bind(t),e.onok=v.bind(t),e.onback=L.bind(t),e.onselect=y.bind(t),e.onlayoutchange=C.bind(t),n.onok=e.onok,n.onback=L.bind(t),n.onselect=y.bind(t),n.onlayoutchange=C.bind(t)},h=function(t){var o=t.actionTileController(),e=l(t),r=a(t),i=e.color(),c=r.color();o.reset(),e.panels([n.sample(i),n.sample(i),n.sample(i)]),e.resetScore(),r.panels([n.sample(c),n.sample(c),null]),r.resetScore()},p=function(t){var o=l(t),e=a(t);o.active(!0),e.active(!1)},u=function(t){var o=l(t),e=a(t);o.active(!1),e.active(!1)},f=function(t){setTimeout(function(){d(t),c(t),h(t),p(t),e.redraw(!0)},500)},d=function(t){var o=t.whiteControlBoardController(),e=t.blackControlBoardController(),n="",r=o.totalScore(),i=e.totalScore();if(r===i)n+="Draw";else{var l=r>i?"white":"black";n+="The "+l+" player wins!"}n+="\n\n[Score]\nwhite: "+r+"\nblack: "+i,alert(n)},O=function(t){var o=l(this);o.addScore(r.COLOR_RED,t.red),o.addScore(r.COLOR_YELLOW,t.yellow),o.addScore(r.COLOR_GREEN,t.green)},T=function(){var t=this.actionTileController(),o=l(this),n=a(this);n.supplyPanel();var r=t.canJointAnyPosition(n.panels()),i=t.canJointAnyPosition(o.panels());r||i?(c(this),p(this)):f(this),e.redraw(!0)},v=function(){var t=this.actionTileController(),o=l(this),e=t.selectedPanel(),n=t.canJointAnyPosition(o.panels()),r=t.selectedPosition();if(e&&(n||!r)){if(!n)return t.clearSelection(),o.removeSelectedPanel(),c(this),o=l(this),o.supplyPanel(),void p(this);if(r){var i=r.row,a=r.col;t.canJoint(i,a,e)&&(u(this),t.panel(i,a,e),t.clearSelection(),o.removeSelectedPanel(),t.startScoreAnimation(i,a))}}},L=function(){var t=this.actionTileController();t.clearSelection()},y=function(t){var o=this.actionTileController();o.selectedPanel(t.panel)},C=function(){var t=this.actionTileController(),o=l(this),e=t.selectedPanel(),n=t.selectedPosition();e&&!n&&o.resetRotation(e)};o.TurnController=i,t.app=o}(this),function(t){"use strict";var o=t.app||{},e=t.m,n=o.Panel,r=function(t){var o=t.panel(),r=t.x(),s=t.y(),h=t.width(),p=[],u=[],f=o&&o.color()===n.COLOR_BROWN,d=!o||o.isFixed();f?u.push("edge"):o&&u.push(d?"fixed":"unfixed"),p.push(e("rect.base",{x:-(h/2)+.5,y:-(h/2)+.5,width:h-1,height:h-1}));var O="translate("+r+" "+s+")";if(!o)return e("g.panel "+u.join("."),{transform:O},p);var T=o.color();return T===n.COLOR_GRAY?u.push("gray"):T===n.COLOR_WHITE?u.push("white"):T===n.COLOR_BLACK&&u.push("black"),d||f||(o.eachJoint(function(t){p.push(i(h,t))}),p.push(e("circle.color.back",{cx:0,cy:0,r:h/3.2+3})),o.eachJoint(function(t){p.push(l(h,t))})),o.eachJoint(function(t){p.push(a(h,t)),p.push(c(h,t))}),f||p.push(e("circle.color.circle",{cx:0,cy:0,r:h/3.2})),e("g.panel "+u.join("."),{transform:O},p)},i=function(t,o){var r={width:t/4,height:t/4};switch(o){case n.JOINT_TOP:r.x=-(t/8),r.y=-(t/2);break;case n.JOINT_RIGHT:r.x=t/2-t/4,r.y=-(t/8);break;case n.JOINT_BOTTOM:r.x=-(t/8),r.y=t/4;break;case n.JOINT_LEFT:r.x=-(t/2),r.y=-(t/8)}return e("rect.joint.back.border",r)},l=function(t,o){var r={};switch(o){case n.JOINT_TOP:r.x=-(t/8)+1,r.y=-(t/2)+1,r.width=t/4-2,r.height=t/4;break;case n.JOINT_RIGHT:r.x=t/2-t/4+1,r.y=-(t/8)+1,r.width=t/4-2,r.height=t/4-2;break;case n.JOINT_BOTTOM:r.x=-(t/8)+1,r.y=t/4+1,r.width=t/4-2,r.height=t/4-2;break;case n.JOINT_LEFT:r.x=-(t/2)+1,r.y=-(t/8)+1,r.width=t/4,r.height=t/4-2}return e("rect.joint.back",r)},a=function(t,o){var r={};switch(o){case n.JOINT_TOP:r.x=-(t/8)+3,r.y=-(t/2),r.width=t/4-6,r.height=t/4+1;break;case n.JOINT_RIGHT:r.x=t/2-t/4-1,r.y=-(t/8)+3,r.width=t/4+1,r.height=t/4-6;break;case n.JOINT_BOTTOM:r.x=-(t/8)+3,r.y=t/4-1,r.width=t/4-6,r.height=t/4+1;break;case n.JOINT_LEFT:r.x=-(t/2),r.y=-(t/8)+3,r.width=t/4+1,r.height=t/4-6}return e("rect.joint.handle.border",r)},c=function(t,o){var r={};switch(o){case n.JOINT_TOP:r.x=-(t/8)+4,r.y=-(t/2)-.3,r.width=t/4-8,r.height=t/4+.3;break;case n.JOINT_RIGHT:r.x=t/2-t/4,r.y=-(t/8)+4,r.width=t/4+.3,r.height=t/4-8;break;case n.JOINT_BOTTOM:r.x=-(t/8)+4,r.y=t/4,r.width=t/4-8,r.height=t/4+.3;break;case n.JOINT_LEFT:r.x=-(t/2)-.3,r.y=-(t/8)+4,r.width=t/4,r.height=t/4-8}return e("rect.joint.handle",r)};o.panelView=r,t.app=o}(this),function(t){"use strict";var o=t.app||{},e=t.m,n=t.util,r=n.supportsTransitionEnd,i=n.$createPanelView,l=function(t){var o=t.panelWidth(),n=t.scoreColors(),l=t.rowLength(),a=t.colLength();return e("g.tile",[e("rect.back",{x:-(o*a/2),y:-(o*l/2),width:o*a,height:o*l}),e("g",t.panels().map(function(t,e){return t.map(function(t,n){return i({panel:t,x:-(o*a/2)+n*o+o/2,y:-(o*l/2)+e*o+o/2,width:o})})})),e("g.score-animation",n.map(function(t){return e("circle.circle",{className:t.color+(r?" animation":""),cx:(t.col-a/2)*o+o/2,cy:(t.row-l/2)*o+o/2,r:o/3.2})}))])};o.tileView=l,t.app=o}(this),function(t){"use strict";var o=t.app||{},e=t.m,n=t.util,r=o.tileView,i=n.supportsTouch,l=n.supportsTransitionEnd,a=n.addClass,c=n.replaceClass,s=n.$globalToLocal,h=n.$createPanelView,p=function(t){var o=t.selectedPanel(),n=t.selectedPosition(),i=[],l=e.prop(null);return o&&n&&i.push(u(t,function(t){l(t.element)})),i.push(f(t,l)),[r(t),e("g.action-tile",i)]},u=function(t,o){var n=t.selectedPanel(),r=t.selectedPosition(),i=t.panelWidth(),l=t.rowLength(),c=t.colLength(),s=(r.col-c/2)*i+i/2,p=(r.row-l/2)*i+i/2;return e("g",{transform:"translate("+s+" "+p+")",config:function(e,n){if(!n){var r=e.childNodes[0];a(r,"stop"),r.addEventListener("transitionend",function(){O(t,r)}),o({element:r})}}},[h({panel:n,x:0,y:0,width:i})])},f=function(t,o){var n=t.selectedPanel(),r=t.selectedPosition(),l=t.panelWidth(),a=t.rowLength(),c=t.colLength();return e("rect.hitarea",{x:-(l*c/2),y:-(l*a/2),width:l*c,height:l*a,startHandler:function(e){var i=e.clientX||e.touches[0].clientX,l=e.clientY||e.touches[0].clientY;n&&r?d(t,o()):T(t,i,l)},config:function(t,o){if(!o){var e=i?"touchstart":"mousedown";t.addEventListener(e,this.attrs.startHandler)}}})},d=function(t,o){l?c(o,"stop","rotate"):O(t,o)},O=function(t,o){t.dispatchEvent({type:"rotationend"}),c(o,"rotate","stop")},T=function(t,o,e){var n=t.panelWidth(),r=t.rowLength(),i=t.colLength(),l=s({x:o,y:e}),a=parseInt((l.y+n*r/2)/n,10),c=parseInt((l.x+n*i/2)/n,10);t.dispatchEvent({type:"select",row:a,col:c})};o.actionTileView=p,t.app=o}(this),function(t){"use strict";var o=t.app||{},e=t.m,n=t.util,r=o.Panel,i=o.ControlBoardController,l=n.supportsTouch,a=(n.windowAspectRatio,n.$createPanelView),c=function(t){var o=t.color(),n=t.active(),l=t.panels(),a=t.selectedIndex(),c=t.score(),d=t.panelWidth(),O=t.layout(),v=[],L="",y=0,C=0;o===r.COLOR_WHITE?(O===i.LAYOUT_VERTICAL?y=-384:C=378,L="white"):o===r.COLOR_BLACK&&(O===i.LAYOUT_VERTICAL?y=384:C=-378,L="black");var w=function(){t.dispatchEvent({type:"ok"})},g=function(){t.dispatchEvent({type:"back"})},R=function(o){t.dispatchEvent({type:"select",selectedIndex:o.selectedIndex})};return O===i.LAYOUT_VERTICAL?(n&&v.push(s(-84+y,-312+C,168,24)),v.push(h(-84+y,-288+C,168,576)),v.push(e("g",p(-60+y,-264+C,120,42,w))),v.push(e("g",u(-60+y,-198+C,120,42,g))),v.push(f(l,a,d,-48+y,-132+C,O,R)),v.push(e("g",T(c,-36+y,180+C)))):O===i.LAYOUT_HORIZONTAL_INVERSE?(n&&v.push(s(288+y,-78+C,24,156)),v.push(h(-288+y,-78+C,576,156)),v.push(e("g.inverse",p(150+y,-54+C,120,42,w))),v.push(e("g.inverse",u(150+y,12+C,120,42,g))),v.push(f(l,a,d,-132+y,-48+C,O,R)),v.push(e("g.inverse",T(c,180+y,-36+C)))):(n&&v.push(s(-312+y,-78+C,24,156)),v.push(h(-288+y,-78+C,576,156)),v.push(e("g",p(-270+y,-54+C,120,42,w))),v.push(e("g",u(-270+y,12+C,120,42,g))),v.push(f(l,a,d,-132+y,-48+C,O,R)),v.push(e("g",T(c,180+y,-36+C)))),e("g.control-board",{className:L,config:function(o,e,n){var r=t.layout();r!==n.layout&&(t.dispatchEvent({type:"layoutchange"}),n.layout=r)}},v)},s=function(t,o,n,r){return e("rect.active",{x:t,y:o,width:n,height:r})},h=function(t,o,n,r){return e("rect.back",{x:t,y:o,width:n,height:r})},p=function(t,o,n,r,i){return e("g.button",[e("rect.rect.back",{x:t,y:o,width:n,height:r,onclick:i}),e("text.text.ok",{x:t+n/2,y:o+r/2+8},"O K")])},u=function(t,o,n,r,i){return e("g.button",[e("rect.rect.back",{x:t,y:o,width:n,height:r,onclick:i}),e("text.text.back",{x:t+n/2,y:o+r/2+6},"Back")])},f=function(t,o,n,r,l,a,c){var s,h,p=d(t,o,n,r,l,a),u=O(t,n,r,l,a,c);return a===i.LAYOUT_VERTICAL?(s=n+24,h=(n+12)*t.length+12):(s=(n+12)*t.length+12,h=n+24),e("g.slot",[e("rect.back",{x:r,y:l,width:s,height:h}),e("g",p),e("g",u)])},d=function(t,o,n,r,l,c){return t.map(function(s,h){if(!t)return null;var p={},u=o===h;return c===i.LAYOUT_VERTICAL?(p.x=r+12+n/2,p.y=l+12+(n+12)*h+n/2):c===i.LAYOUT_HORIZONTAL?(p.x=r+12+(n+12)*h+n/2,p.y=l+12+n/2):c===i.LAYOUT_HORIZONTAL_INVERSE&&(p.x=r+12+(n+12)*(t.length-h-1)+n/2,p.y=l+12+n/2),e("g",{className:u?"selected":""},[a({panel:s,x:p.x,y:p.y,width:n})])})},O=function(t,o,n,r,a,c){return t.map(function(s,h){if(!t)return null;var p={};a===i.LAYOUT_VERTICAL?(p.x=n+12,p.y=r+12+(o+12)*h):a===i.LAYOUT_HORIZONTAL?(p.x=n+12+(o+12)*h,p.y=r+12):a===i.LAYOUT_HORIZONTAL_INVERSE&&(p.x=n+12+(o+12)*(t.length-h-1),p.y=r+12);var u={x:p.x,y:p.y,width:o,height:o,index:h,selectHandler:function(t){return function(){c({selectedIndex:t})}}(h),config:function(t,o){if(!o){var e=l?"touchstart":"mousedown";t.addEventListener(e,this.attrs.selectHandler)}}};return e("rect.hitarea",u)})},T=function(t,o,n){return e("g.score",[e("g.red",[e("circle.circle",{cx:o,cy:n,r:12}),e("text.text",{x:o+26,y:n+7},"×"),e("text.text",{x:o+52,y:n+7},t.red())]),e("g.yellow",[e("circle.circle",{cx:o,cy:n+34,r:12}),e("text.text",{x:o+26,y:n+41},"×"),e("text.text",{x:o+52,y:n+41},t.yellow())]),e("g.green",[e("circle.circle",{cx:o,cy:n+68,r:12}),e("text.text",{x:o+26,y:n+75},"×"),e("text.text",{x:o+52,y:n+75},t.green())])])};o.controlBoardView=c,t.app=o}(this),function(t){"use strict";var o=t.app||{},e=t.m,n=t.util,r=t.window,i=t.document,l=n.windowAspectRatio;o.controller=function(){var t=o.Panel,e=o.ActionTileController,n=o.ControlBoardController,r=o.TurnController;this.actionTileController=new e,this.whiteControlBoardController=new n({color:t.COLOR_WHITE}),this.blackControlBoardController=new n({color:t.COLOR_BLACK}),new r({turnPlayerColor:t.COLOR_WHITE,actionTileController:this.actionTileController,whiteControlBoardController:this.whiteControlBoardController,blackControlBoardController:this.blackControlBoardController}).start()},o.view=function(t){var n=o.actionTileView,i=o.controlBoardView,a=o.view.className,c="svg."+a+".unselectable",s={viewBox:"-360,-360,720,720",config:function(t,o){o||r.addEventListener("resize",function(){var t=l()>=1;return function(){var o=l()>=1;o!==t&&(e.redraw(),t=o)}}())}},h=[n(t.actionTileController),i(t.whiteControlBoardController),i(t.blackControlBoardController)];return e(c,s,h)},o.view.className="stage",e.module(i.getElementById("container"),o),t.app=o}(this);