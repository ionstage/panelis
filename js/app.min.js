!function(t){"use strict";var e=t.app||{},o=t.m||require("mithril"),n=function(){return 0===Math.floor(2*Math.random())},r=function(t,e,n,i,a,l){this.color=o.prop(t||r.COLOR_BROWN),this.isFixed=o.prop(l||!1),this._topJoint=o.prop(e||!1),this._rightJoint=o.prop(n||!1),this._bottomJoint=o.prop(i||!1),this._leftJoint=o.prop(a||!1)};r.prototype.mixColor=function(t){var e=this.color();t===r.COLOR_WHITE?e===r.COLOR_BLACK?this.color(r.COLOR_GRAY):e===r.COLOR_GRAY&&this.color(r.COLOR_WHITE):t===r.COLOR_BLACK&&(e===r.COLOR_WHITE?this.color(r.COLOR_GRAY):e===r.COLOR_GRAY&&this.color(r.COLOR_BLACK))},r.prototype.hasJoint=function(t,e){return"undefined"==typeof e?this["_"+t+"Joint"]():void this["_"+t+"Joint"](e)},r.prototype.rotate=function(){var t=this.hasJoint(r.JOINT_TOP);this.hasJoint(r.JOINT_TOP,this.hasJoint(r.JOINT_LEFT)),this.hasJoint(r.JOINT_LEFT,this.hasJoint(r.JOINT_BOTTOM)),this.hasJoint(r.JOINT_BOTTOM,this.hasJoint(r.JOINT_RIGHT)),this.hasJoint(r.JOINT_RIGHT,t)},r.prototype.resetRotation=function(){for(var t=0;4>t;t++){for(var e=this.hasJoint(r.JOINT_TOP),o=this.hasJoint(r.JOINT_RIGHT),n=this.hasJoint(r.JOINT_BOTTOM),a=this.hasJoint(r.JOINT_LEFT),l=0,s=i.length;s>l;l++){var c=i[l];if(c.hasJoint(r.JOINT_TOP)===e&&c.hasJoint(r.JOINT_RIGHT)===o&&c.hasJoint(r.JOINT_BOTTOM)===n&&c.hasJoint(r.JOINT_LEFT)===a)return}this.rotate()}},r.prototype.clone=function(){return new r(this.color(),this.hasJoint(r.JOINT_TOP),this.hasJoint(r.JOINT_RIGHT),this.hasJoint(r.JOINT_BOTTOM),this.hasJoint(r.JOINT_LEFT),this.isFixed())},r.sample=function(t,e){var o,a,l,s;if(e)o=e===r.JOINT_TOP?n():!1,a=e===r.JOINT_RIGHT?n():!1,l=e===r.JOINT_BOTTOM?n():!1,s=e===r.JOINT_LEFT?n():!1;else{var c=i[Math.floor(5*Math.random())];o=c.hasJoint(r.JOINT_TOP),a=c.hasJoint(r.JOINT_RIGHT),l=c.hasJoint(r.JOINT_BOTTOM),s=c.hasJoint(r.JOINT_LEFT)}return new r(t,o,a,l,s)},r.COLOR_BROWN="brown",r.COLOR_WHITE="white",r.COLOR_BLACK="black",r.COLOR_GRAY="gray",r.JOINT_TOP="top",r.JOINT_LEFT="left",r.JOINT_BOTTOM="bottom",r.JOINT_RIGHT="right";var i=[new r(null,!0,!1,!1,!1),new r(null,!0,!0,!1,!1),new r(null,!0,!1,!0,!1),new r(null,!0,!0,!0,!1),new r(null,!0,!0,!0,!0)];e.Panel=r,t.app=e}(this),function(t){"use strict";var e=t.app||{},o=t.m||require("mithril"),n=e.Panel||require("./panel.js").app.Panel,r=function(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var o in t)if(t[o]!==e[o])return!1;return!0},i=function(t){for(var e=[],o=0,n=t.length;n>o;o++){for(var i=!0,a=t[o],l=0,s=e.length;s>l;l++){var c=e[l];r(a,c)&&(i=!1)}i&&e.push(a)}return e},a=function(t,e){this.panels=o.prop([[]]),this.rowLength=o.prop(t||8),this.colLength=o.prop(e||8),this.reset()};a.prototype.panel=function(t,e,o){var n=this.panels();return"undefined"==typeof o?n[t][e]:void(n[t][e]=o)},a.prototype.fix=function(t,e){var o=this.panel(t,e);o.isFixed(!0)},a.prototype.canFix=function(t,e,o){var r=this.panels();if(0>=t||t>=r.length-1)return!1;if(0>=e||e>=r[0].length-1)return!1;var i=this.panel(t,e)||o,a=this.panel(t-1,e);if(i.hasJoint(n.JOINT_TOP)&&(!a||!a.hasJoint(n.JOINT_BOTTOM)))return!1;var l=this.panel(t,e+1);if(i.hasJoint(n.JOINT_RIGHT)&&(!l||!l.hasJoint(n.JOINT_LEFT)))return!1;var s=this.panel(t+1,e);if(i.hasJoint(n.JOINT_BOTTOM)&&(!s||!s.hasJoint(n.JOINT_TOP)))return!1;var c=this.panel(t,e-1);return!i.hasJoint(n.JOINT_LEFT)||c&&c.hasJoint(n.JOINT_RIGHT)?!0:!1},a.prototype.canJoint=function(t,e,o){var r=this.panels();if(0>=t||t>=r.length-1)return!1;if(0>=e||e>=r[0].length-1)return!1;var i=this.panel(t,e)||o,a=this.panel(t-1,e);if(a&&(!a.hasJoint(n.JOINT_BOTTOM)&&i.hasJoint(n.JOINT_TOP)||a.hasJoint(n.JOINT_BOTTOM)&&!i.hasJoint(n.JOINT_TOP)))return!1;var l=this.panel(t,e+1);if(l&&(!l.hasJoint(n.JOINT_LEFT)&&i.hasJoint(n.JOINT_RIGHT)||l.hasJoint(n.JOINT_LEFT)&&!i.hasJoint(n.JOINT_RIGHT)))return!1;var s=this.panel(t+1,e);if(s&&(!s.hasJoint(n.JOINT_TOP)&&i.hasJoint(n.JOINT_BOTTOM)||s.hasJoint(n.JOINT_TOP)&&!i.hasJoint(n.JOINT_BOTTOM)))return!1;var c=this.panel(t,e-1);return c&&(!c.hasJoint(n.JOINT_RIGHT)&&i.hasJoint(n.JOINT_LEFT)||c.hasJoint(n.JOINT_RIGHT)&&!i.hasJoint(n.JOINT_LEFT))?!1:!0},a.prototype.canJointAnyPosition=function(t){var e=this.panels(),o=this.rowLength(),n=this.colLength();if(0===o||0===n)return!1;if(Array.isArray(t))for(var r=0,i=t.length;i>r;r++){var a=t[r];if(a&&this.canJointAnyPosition(a))return!0}else for(var a=t.clone(),l=0;o>l;l++)for(var s=0;n>s;s++)if(!e[l][s])for(var c=0;4>c;c++){if(this.canJoint(l,s,a))return!0;a.rotate()}return!1},a.prototype.isJointed=function(t,e,o,r){return this.panel(t,e)&&this.panel(o,r)?t===o+1&&e===r&&this.panel(t,e).hasJoint(n.JOINT_TOP)&&this.panel(o,r).hasJoint(n.JOINT_BOTTOM)?!0:t===o&&e===r-1&&this.panel(t,e).hasJoint(n.JOINT_RIGHT)&&this.panel(o,r).hasJoint(n.JOINT_LEFT)?!0:t===o-1&&e===r&&this.panel(t,e).hasJoint(n.JOINT_BOTTOM)&&this.panel(o,r).hasJoint(n.JOINT_TOP)?!0:t===o&&e===r+1&&this.panel(t,e).hasJoint(n.JOINT_LEFT)&&this.panel(o,r).hasJoint(n.JOINT_RIGHT)?!0:!1:!1},a.prototype.releaseColor=function(t,e){var o=this.panel(t,e),r=o.color(),i=!1,a=this.panel(t-1,e);a&&!a.isFixed()&&a.color()!==r&&a.color()!==n.COLOR_BROWN&&a.hasJoint(n.JOINT_BOTTOM)&&o.hasJoint(n.JOINT_TOP)&&(a.mixColor(r),i=!0);var l=this.panel(t,e+1);l&&!l.isFixed()&&l.color()!==r&&l.color()!==n.COLOR_BROWN&&l.hasJoint(n.JOINT_LEFT)&&o.hasJoint(n.JOINT_RIGHT)&&(l.mixColor(r),i=!0);var s=this.panel(t+1,e);s&&!s.isFixed()&&s.color()!==r&&s.color()!==n.COLOR_BROWN&&s.hasJoint(n.JOINT_TOP)&&o.hasJoint(n.JOINT_BOTTOM)&&(s.mixColor(r),i=!0);var c=this.panel(t,e-1);return c&&!c.isFixed()&&c.color()!==r&&c.color()!==n.COLOR_BROWN&&c.hasJoint(n.JOINT_RIGHT)&&o.hasJoint(n.JOINT_LEFT)&&(c.mixColor(r),i=!0),i},a.prototype.calcChain=function(t,e){var o=this.panel(t,e);if(!o)return[];var n=o.color(),a=[[{row:t,col:e}]],l=[{row:t,col:e}],s=this;return function c(t){for(var e=a[t],o=[],h=0,p=e.length;p>h;h++){var u=e[h];s.isJointed(u.row,u.col,u.row-1,u.col)&&s.panel(u.row-1,u.col).color()===n&&o.push({row:u.row-1,col:u.col}),s.isJointed(u.row,u.col,u.row,u.col+1)&&s.panel(u.row,u.col+1).color()===n&&o.push({row:u.row,col:u.col+1}),s.isJointed(u.row,u.col,u.row+1,u.col)&&s.panel(u.row+1,u.col).color()===n&&o.push({row:u.row+1,col:u.col}),s.isJointed(u.row,u.col,u.row,u.col-1)&&s.panel(u.row,u.col-1).color()===n&&o.push({row:u.row,col:u.col-1})}o=i(o).filter(function(t){for(var e=0,o=l.length;o>e;e++){var n=l[e];if(r(t,n))return!1}return!0}),Array.prototype.push.apply(l,o),o.length>0&&(a[t+1]=o,c(t+1))}(0),a},a.prototype.reset=function(){for(var t=this.panels(),e=this.rowLength(),o=this.colLength(),n=0;e>n;n++){t[n]=[];for(var r=0;o>r;r++)t[n][r]=null}},a.prototype.randomEdge=function(){var t=this.panels(),e=this.rowLength(),o=this.colLength();t[0][0]=new n,t[0][o-1]=new n,t[e-1][0]=new n,t[e-1][o-1]=new n;for(var r=1;o-1>r;r++)t[0][r]=n.sample(n.COLOR_BROWN,n.JOINT_BOTTOM);for(var i=1;e-1>i;i++)t[i][o-1]=n.sample(n.COLOR_BROWN,n.JOINT_LEFT);for(var r=1;o-1>r;r++)t[e-1][r]=n.sample(n.COLOR_BROWN,n.JOINT_TOP);for(var i=1;e-1>i;i++)t[i][0]=n.sample(n.COLOR_BROWN,n.JOINT_RIGHT)},e.Tile=a,t.app=e}(this),function(t){"use strict";var e=t.app||{},o=t.m||require("mithril"),n=function(t,e,n){this.red=o.prop(t||0),this.yellow=o.prop(e||0),this.green=o.prop(n||0)};n.prototype.add=function(t,e){this[t](this[t]()+e)},n.prototype.reset=function(){this.red(0),this.yellow(0),this.green(0)},n.prototype.total=function(){return 100*this.red()+50*this.yellow()+300*this.green()},n.COLOR_RED="red",n.COLOR_YELLOW="yellow",n.COLOR_GREEN="green",e.Score=n,t.app=e}(this),function(t){"use strict";var e=t.app||{},o=t.m||require("mithril"),n=e.Panel,r=e.Tile,i=e.Score,a=function(){},l=function(){this.tile=o.prop(new r),this.panelWidth=o.prop(72),this.scoreColors=o.prop([]),this.onscorechange=a,this.onscoreanimationend=a};l.prototype.panel=function(t,e,o){this.tile().panel(t,e,o)},l.prototype.canJoint=function(t,e,o){return this.tile().canJoint(t,e,o)},l.prototype.canJointAnyPosition=function(t){return this.tile().canJointAnyPosition(t)},l.prototype.reset=function(){var t=this.tile();t.reset(),t.randomEdge()},l.prototype.startScoreAnimation=function(t,e){var n=this,r=[h,p,u,T];setTimeout(function(){!function i(a){var l=r[a];if(!l)return void n.onscoreanimationend();var s=l(n,t,e,r);s&&o.redraw(!0),setTimeout(function(){o.redraw(!0),i(a+1),c(n)},s?500:0)}(0)},250)};var s=function(t,e){t.scoreColors().push(e)},c=function(t){t.scoreColors([])},h=function(t,e,o){var n=t.tile();return n.canFix(e,o)?(n.fix(e,o),s(t,{row:e,col:o,color:i.COLOR_GREEN}),t.onscorechange({red:0,yellow:0,green:1}),!0):!1},p=function(t,e,o){return t.tile().releaseColor(e,o)},u=function(t,e,o){var n=!1,r={red:0,yellow:0,green:0};return n=O(t,e,o,e-1,o,r)||n,n=O(t,e,o,e,o+1,r)||n,n=O(t,e,o,e+1,o,r)||n,n=O(t,e,o,e,o-1,r)||n,t.onscorechange(r),n},O=function(t,e,o,r,a,l){var c=t.tile(),h=c.panel(r,a);return h&&c.isJointed(e,o,r,a)?h.color()===n.COLOR_BROWN?!1:!c.canFix(r,a)||h.isFixed()?!1:(h.color()===n.COLOR_GRAY?(c.panel(r,a,null),s(t,{row:e,col:o,color:i.COLOR_RED}),l.red+=1):(c.fix(r,a),s(t,{row:r,col:a,color:i.COLOR_GREEN}),l.green+=1),!0):!1},T=function(t,e,o,n){var r=t.tile(),a=r.calcChain(e,o);if(a.length<2)return!1;var l=a.map(function(e){return function(){return e.forEach(function(e){s(t,{row:e.row,col:e.col,color:i.COLOR_YELLOW}),t.onscorechange({red:0,yellow:1,green:0})}),!0}});return Array.prototype.push.apply(n,l),!1};e.TileController=l,t.app=e}(this),function(t){"use strict";var e=t.app||{},o=t.m||require("mithril"),n=function(t,e){return t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),t},r=e.TileController,i=n(function(){i.super_.call(this),this.selectedPanel=o.prop(null),this.selectedPosition=o.prop(null)},r);i.prototype.clearSelection=function(){this.selectedPanel(null),this.selectedPosition(null)},i.prototype.dispatchEvent=function(t){var e=this.tile(),n=this.selectedPanel(),r=this.selectedPosition();switch(t.type){case"select":if(!n||r)break;var i=t.row,a=t.col;if(e.panel(i,a))break;this.selectedPosition({row:i,col:a}),o.redraw(!0);break;case"rotationend":if(!n)break;n.rotate(),o.redraw(!0)}},e.ActionTileController=i,t.app=e}(this),function(t){"use strict";var e=t.app||{},o=t.m||require("mithril"),n=e.Panel,r=e.Score,i=function(){},a=function(t){this.color=o.prop(t.color),this.active=o.prop(!1),this.panels=o.prop([null,null,null]),this.selectedPanel=o.prop(null),this.score=o.prop(new r),this.panelWidth=o.prop(72),this.onok=i,this.onback=i,this.onselect=i};a.prototype.supplyPanel=function(){for(var t=this.color(),e=this.panels(),o=0,r=e.length;r>o;o++)e[o]||(e[o]=n.sample(t))},a.prototype.selectedIndex=function(){for(var t=this.panels(),e=this.selectedPanel(),o=0,n=t.length;n>o;o++)if(t[o]===e)return o;return-1},a.prototype.removeSelectedPanel=function(){this.panels()[this.selectedIndex()]=null,this.selectedPanel(null)},a.prototype.addScore=function(t,e){this.score().add(t,e)},a.prototype.resetScore=function(){this.score().reset()},a.prototype.totalScore=function(){return this.score().total()},a.prototype.dispatchEvent=function(t){var e=this.active(),n=this.panels(),r=this.selectedPanel();if(e)switch(t.type){case"ok":if(!r)break;this.onok();break;case"back":if(!r)break;r.resetRotation(),this.selectedPanel(null),this.onback();break;case"select":if(r)break;var i=n[t.selectedIndex];this.selectedPanel(i),o.redraw(!0),this.onselect({panel:i})}},e.ControlBoardController=a,t.app=e}(this),function(t){"use strict";var e=t.app||{},o=t.m||require("mithril"),n=e.Panel,r=e.Score,i=function(t){this.turnPlayerColor=o.prop(t.turnPlayerColor),this.actionTileController=o.prop(t.actionTileController),this.whiteControlBoardController=o.prop(t.whiteControlBoardController),this.blackControlBoardController=o.prop(t.blackControlBoardController)};i.prototype.start=function(){c(this),h(this),p(this)};var a=function(t){var e=t.turnPlayerColor();return e===n.COLOR_WHITE?t.whiteControlBoardController():e===n.COLOR_BLACK?t.blackControlBoardController():null},l=function(t){var e=t.turnPlayerColor();return e===n.COLOR_WHITE?t.blackControlBoardController():e===n.COLOR_BLACK?t.whiteControlBoardController():null},s=function(t){var e=t.turnPlayerColor();e===n.COLOR_WHITE?t.turnPlayerColor(n.COLOR_BLACK):e===n.COLOR_BLACK&&t.turnPlayerColor(n.COLOR_WHITE)},c=function(t){var e=t.actionTileController(),o=t.whiteControlBoardController(),n=t.blackControlBoardController();e.onscorechange=f.bind(t),e.onscoreanimationend=d.bind(t),o.onok=J.bind(t),o.onback=_.bind(t),o.onselect=C.bind(t),n.onok=o.onok,n.onback=_.bind(t),n.onselect=C.bind(t)},h=function(t){var e=t.actionTileController(),o=a(t),r=l(t),i=o.color(),s=r.color();e.reset(),o.panels([n.sample(i),n.sample(i),n.sample(i)]),o.resetScore(),r.panels([n.sample(s),n.sample(s),null]),r.resetScore()},p=function(t){var e=a(t),o=l(t);e.active(!0),o.active(!1)},u=function(t){var e=a(t),o=l(t);e.active(!1),o.active(!1)},O=function(t){setTimeout(function(){T(t),s(t),h(t),p(t),o.redraw(!0)},500)},T=function(t){var e=t.whiteControlBoardController(),o=t.blackControlBoardController(),n="",r=e.totalScore(),i=o.totalScore();if(r===i)n+="Draw";else{var a=r>i?"white":"black";n+="The "+a+" player wins!"}n+="\n\n[Score]\nwhite: "+r+"\nblack: "+i,alert(n)},f=function(t){var e=a(this);e.addScore(r.COLOR_RED,t.red),e.addScore(r.COLOR_YELLOW,t.yellow),e.addScore(r.COLOR_GREEN,t.green)},d=function(){var t=this.actionTileController(),e=a(this),n=l(this);n.supplyPanel();var r=t.canJointAnyPosition(n.panels()),i=t.canJointAnyPosition(e.panels());r||i?(s(this),p(this)):O(this),o.redraw(!0)},J=function(){var t=this.actionTileController(),e=a(this),o=t.selectedPanel(),n=t.canJointAnyPosition(e.panels()),r=t.selectedPosition();if(o&&(n||!r)){if(!n)return t.clearSelection(),e.removeSelectedPanel(),s(this),e=a(this),e.supplyPanel(),void p(this);if(r){var i=r.row,l=r.col;t.canJoint(i,l,o)&&(u(this),t.panel(i,l,o),t.clearSelection(),e.removeSelectedPanel(),t.startScoreAnimation(i,l))}}},_=function(){var t=this.actionTileController();t.clearSelection()},C=function(t){var e=this.actionTileController();e.selectedPanel(t.panel)};e.TurnController=i,t.app=e}(this),function(t){"use strict";var e=t.app||{},o=t.m||require("mithril"),n=e.Panel,r=[n.JOINT_TOP,n.JOINT_RIGHT,n.JOINT_BOTTOM,n.JOINT_LEFT],i=function(t){var e=t.panel(),i=t.x(),h=t.y(),p=t.width(),u=[],O=[],T=e&&e.color()===n.COLOR_BROWN,f=!e||e.isFixed();T?O.push("edge"):e&&O.push(f?"fixed":"unfixed"),u.push(o("rect.base",{x:-(p/2)+.5,y:-(p/2)+.5,width:p-1,height:p-1}));var d="translate("+i+" "+h+")";if(!e)return o("g.panel "+O.join("."),{transform:d},u);var J=e.color();return J===n.COLOR_GRAY?O.push("gray"):J===n.COLOR_WHITE?O.push("white"):J===n.COLOR_BLACK&&O.push("black"),f||T||(r.forEach(function(t){e.hasJoint(t)&&u.push(a(p,t))}),u.push(o("circle.color.back",{cx:0,cy:0,r:p/3.2+3})),r.forEach(function(t){e.hasJoint(t)&&u.push(l(p,t))})),r.forEach(function(t){e.hasJoint(t)&&(u.push(s(p,t)),u.push(c(p,t)))}),T||u.push(o("circle.color.circle",{cx:0,cy:0,r:p/3.2})),o("g.panel "+O.join("."),{transform:d},u)},a=function(t,e){var r={width:t/4,height:t/4};switch(e){case n.JOINT_TOP:r.x=-(t/8),r.y=-(t/2);break;case n.JOINT_RIGHT:r.x=t/2-t/4,r.y=-(t/8);break;case n.JOINT_BOTTOM:r.x=-(t/8),r.y=t/4;break;case n.JOINT_LEFT:r.x=-(t/2),r.y=-(t/8)}return o("rect.joint.back.border",r)},l=function(t,e){var r={};switch(e){case n.JOINT_TOP:r.x=-(t/8)+1,r.y=-(t/2)+1,r.width=t/4-2,r.height=t/4;break;case n.JOINT_RIGHT:r.x=t/2-t/4+1,r.y=-(t/8)+1,r.width=t/4-2,r.height=t/4-2;break;case n.JOINT_BOTTOM:r.x=-(t/8)+1,r.y=t/4+1,r.width=t/4-2,r.height=t/4-2;break;case n.JOINT_LEFT:r.x=-(t/2)+1,r.y=-(t/8)+1,r.width=t/4,r.height=t/4-2}return o("rect.joint.back",r)},s=function(t,e){var r={};switch(e){case n.JOINT_TOP:r.x=-(t/8)+3,r.y=-(t/2),r.width=t/4-6,r.height=t/4+1;break;case n.JOINT_RIGHT:r.x=t/2-t/4-1,r.y=-(t/8)+3,r.width=t/4+1,r.height=t/4-6;break;case n.JOINT_BOTTOM:r.x=-(t/8)+3,r.y=t/4-1,r.width=t/4-6,r.height=t/4+1;break;case n.JOINT_LEFT:r.x=-(t/2),r.y=-(t/8)+3,r.width=t/4+1,r.height=t/4-6}return o("rect.joint.handle.border",r)},c=function(t,e){var r={};switch(e){case n.JOINT_TOP:r.x=-(t/8)+4,r.y=-(t/2)-.3,r.width=t/4-8,r.height=t/4+.3;break;case n.JOINT_RIGHT:r.x=t/2-t/4,r.y=-(t/8)+4,r.width=t/4+.3,r.height=t/4-8;break;case n.JOINT_BOTTOM:r.x=-(t/8)+4,r.y=t/4,r.width=t/4-8,r.height=t/4+.3;break;case n.JOINT_LEFT:r.x=-(t/2)-.3,r.y=-(t/8)+4,r.width=t/4,r.height=t/4-8}return o("rect.joint.handle",r)};e.panelView=i,t.app=e}(this),function(t){"use strict";var e=t.app||{},o=t.m||require("mithril"),n=function(t){var n=t.tile(),r=t.panelWidth(),i=t.scoreColors(),a=n.rowLength(),l=n.colLength();return[o("g.tile",[o("rect.back",{x:-(r*l/2),y:-(r*a/2),width:r*l,height:r*a}),o("g",n.panels().map(function(t,o){return t.map(function(t,n){return e.createPanelView({panel:t,x:-(r*l/2)+n*r+r/2,y:-(r*a/2)+o*r+r/2,width:r})})}))]),o("g.score-animation",i.map(function(t){return o("circle.circle",{className:t.color+(e.supportsTransitionEnd?" animation":""),cx:(t.col-l/2)*r+r/2,cy:(t.row-a/2)*r+r/2,r:r/3.2})}))]};e.tileView=n,t.app=e}(this),function(t){"use strict";var e=t.app||{},o=t.m||require("mithril"),n=e.tileView,r=function(t,e){t.setAttribute("class",t.getAttribute("class")+" "+e)},i=function(t,e,o){var n=t.getAttribute("class").replace(e,o);t.setAttribute("class",n)},a=function(t){var e=t.selectedPanel(),r=t.selectedPosition(),i=[],a=o.prop(null);return e&&r&&i.push(l(t,function(t){a(t.element)})),i.push(s(t,a)),[n(t),o("g.action-tile",i)]},l=function(t,n){var i=t.tile(),a=t.selectedPanel(),l=t.selectedPosition(),s=t.panelWidth(),c=i.rowLength(),p=i.colLength(),u=(l.col-p/2)*s+s/2,O=(l.row-c/2)*s+s/2;return o("g",{transform:"translate("+u+" "+O+")",config:function(e,o){if(!o){var i=e.childNodes[0];r(i,"stop"),i.addEventListener("transitionend",function(){h(t,i)}),n({element:i})}}},[e.createPanelView({panel:a,x:0,y:0,width:s})])},s=function(t,n){var r=t.tile(),i=t.selectedPanel(),a=t.selectedPosition(),l=t.panelWidth(),s=r.rowLength(),h=r.colLength();return o("rect.hitarea",{x:-(l*h/2),y:-(l*s/2),width:l*h,height:l*s,startHandler:function(e){var o=e.clientX||e.touches[0].clientX,r=e.clientY||e.touches[0].clientY;i&&a?c(t,n()):p(t,o,r)},config:function(t,o){if(!o){var n=e.supportsTouch?"touchstart":"mousedown";t.addEventListener(n,this.attrs.startHandler)}}})},c=function(t,o){e.supportsTransitionEnd?i(o,"stop","rotate"):h(t,o)},h=function(t,e){t.dispatchEvent({type:"rotationend"}),i(e,"rotate","stop")},p=function(t,o,n){var r=t.tile(),i=t.panelWidth(),a=r.rowLength(),l=r.colLength(),s=e.globalToLocal({x:o,y:n}),c=parseInt((s.y+i*a/2)/i,10),h=parseInt((s.x+i*l/2)/i,10);t.dispatchEvent({type:"select",row:c,col:h})};e.actionTileView=a,t.app=e}(this),function(t){"use strict";var e=t.app||{},o=t.m||require("mithril"),n=e.Panel,r=function(t){var e=t.color(),r=t.active(),h=t.panels(),p=t.selectedIndex(),O=t.score(),T=t.panelWidth(),f=[],d="",J=0,_=0;return e===n.COLOR_WHITE?(J=-384,d="white"):e===n.COLOR_BLACK&&(J=384,d="black"),r&&f.push(i(-84+J,-312+_,168,24)),f.push(a(-84+J,-288+_,168,576)),f.push(l(-60+J,-264+_,120,42,function(){t.dispatchEvent({type:"ok"})})),f.push(s(-60+J,-198+_,120,42,function(){t.dispatchEvent({type:"back"})})),f.push(c(h,p,T,-48+J,-132+_,function(e){t.dispatchEvent({type:"select",selectedIndex:e.selectedIndex})})),f.push(u(O,-36+J,180+_)),o("g.control-board",{className:d},f)},i=function(t,e,n,r){return o("rect.active",{x:t,y:e,width:n,height:r})},a=function(t,e,n,r){return o("rect.back",{x:t,y:e,width:n,height:r})},l=function(t,e,n,r,i){return o("g.button",[o("rect.rect.back",{x:t,y:e,width:n,height:r,onclick:i}),o("text.text.ok",{x:t+n/2,y:e+r/2+8},"O K")])},s=function(t,e,n,r,i){return o("g.button",[o("rect.rect.back",{x:t,y:e,width:n,height:r,onclick:i}),o("text.text.back",{x:t+n/2,y:e+r/2+6},"Back")])},c=function(t,e,n,r,i,a){var l=h(t,e,n,r,i),s=p(t,n,r,i,a);return o("g.slot",[o("rect.back",{x:r,y:i,width:n+24,height:(n+12)*t.length+12}),o("g",l),o("g",s)])},h=function(t,n,r,i,a){return t.map(function(l,s){if(!t)return null;var c=n===s;return o("g",{className:c?"selected":""},[e.createPanelView({panel:l,x:i+12+r/2,y:a+12+(r+12)*s+r/2,width:r})])})},p=function(t,n,r,i,a){return t.map(function(l,s){if(!t)return null;var c={x:r+12,y:i+12+(n+12)*s,width:n,height:n,index:s,selectHandler:function(t){return function(){a({selectedIndex:t})}}(s),config:function(t,o){if(!o){var n=e.supportsTouch?"touchstart":"mousedown";t.addEventListener(n,this.attrs.selectHandler)}}};return o("rect.hitarea",c)})},u=function(t,e,n){return o("g.score",[o("g.red",[o("circle.circle",{cx:e,cy:n,r:12}),o("text.text",{x:e+26,y:n+7},"×"),o("text.text",{x:e+52,y:n+7},t.red())]),o("g.yellow",[o("circle.circle",{cx:e,cy:n+34,r:12}),o("text.text",{x:e+26,y:n+41},"×"),o("text.text",{x:e+52,y:n+41},t.yellow())]),o("g.green",[o("circle.circle",{cx:e,cy:n+68,r:12}),o("text.text",{x:e+26,y:n+75},"×"),o("text.text",{x:e+52,y:n+75},t.green())])])};e.controlBoardView=r,t.app=e}(this),function(t){"use strict";var e=t.app||{},o=t.m||require("mithril");e.supportsTouch="createTouch"in t.document,e.supportsTransitionEnd=function(){var t=document.createElement("div");return"undefined"!=typeof t.style.transition}(),e.globalToLocal=function(t){var e=document.querySelector(".stage"),o=e.createSVGPoint();return o.x=t.x,o.y=t.y,o.matrixTransform(e.getScreenCTM().inverse())},e.createPanelView=function(t){return e.panelView({panel:o.prop(t.panel),x:o.prop(t.x),y:o.prop(t.y),width:o.prop(t.width)})};var n=function(){var t=e.Panel;this.actionTileController=new e.ActionTileController,this.whiteControlBoardController=new e.ControlBoardController({color:t.COLOR_WHITE}),this.blackControlBoardController=new e.ControlBoardController({color:t.COLOR_BLACK}),new e.TurnController({turnPlayerColor:t.COLOR_WHITE,actionTileController:this.actionTileController,whiteControlBoardController:this.whiteControlBoardController,blackControlBoardController:this.blackControlBoardController}).start()},r=function(t){return o("svg.stage.unselectable",{viewBox:"-360,-360,720,720"},[e.actionTileView(t.actionTileController),e.controlBoardView(t.whiteControlBoardController),e.controlBoardView(t.blackControlBoardController)])};o.module(document.getElementById("container"),{controller:n,view:r}),t.app=e}(this);