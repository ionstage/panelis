!function t(o,e,n){function r(l,s){if(!e[l]){if(!o[l]){var a="function"==typeof require&&require;if(!s&&a)return a(l,!0);if(i)return i(l,!0);var c=new Error("Cannot find module '"+l+"'");throw c.code="MODULE_NOT_FOUND",c}var h=e[l]={exports:{}};o[l][0].call(h.exports,function(t){var e=o[l][1][t];return r(e?e:t)},h,h.exports,t,o,e,n)}return e[l].exports}for(var i="function"==typeof require&&require,l=0;l<n.length;l++)r(n[l]);return r}({1:[function(t,o,e){!function(o){"use strict";var e=t("mithril"),n=o.util||t("./util.js"),r=o.Panel||t("./models/panel.js"),i=o.ActionTileController||t("./controllers/action-tile-controller.js"),l=o.ControlBoardController||t("./controllers/control-board-controller.js"),s=o.TurnController||t("./controllers/turn-controller.js"),a=o.actionTileView||t("./views/action-tile-view.js"),c=o.controlBoardView||t("./views/control-board-view.js"),h=function(){this.actionTileController=new i,this.whiteControlBoardController=new l({color:r.COLOR_WHITE}),this.blackControlBoardController=new l({color:r.COLOR_BLACK}),new s({turnPlayerColor:r.COLOR_WHITE,actionTileController:this.actionTileController,whiteControlBoardController:this.whiteControlBoardController,blackControlBoardController:this.blackControlBoardController}).start()},p=function(t){var o="svg.stage.unselectable",r={viewBox:"-360,-360,720,720",config:function(t,o){o||(n.$stageElement(t),n.addResizeEvent(function(){var t=n.windowAspectRatio()>=1;return function(){var o=n.windowAspectRatio()>=1;o!==t&&(e.redraw(),t=o)}}()))}},i=[a(t.actionTileController),c(t.whiteControlBoardController),c(t.blackControlBoardController)];return e(o,r,i)};e.module(n.el("#container"),{controller:h,view:p})}(this.app||(this.app={}))},{"./controllers/action-tile-controller.js":2,"./controllers/control-board-controller.js":3,"./controllers/turn-controller.js":5,"./models/panel.js":6,"./util.js":9,"./views/action-tile-view.js":10,"./views/control-board-view.js":11,mithril:void 0}],2:[function(t,o,e){!function(e){"use strict";var n=t("mithril"),r=e.util||t("../util.js"),i=e.TileController||t("./tile-controller.js"),l=r.inherits(function(){l.super_.call(this),this.selectedPanel=n.prop(null),this.selectedPosition=n.prop(null)},i);l.prototype.clearSelection=function(){this.selectedPanel(null),this.selectedPosition(null)},l.prototype.dispatchEvent=function(t){var o=this.tile(),e=this.selectedPanel(),r=this.selectedPosition();switch(t.type){case"select":if(!e||r)break;var i=t.row,l=t.col;if(o.panel(i,l))break;this.selectedPosition({row:i,col:l}),n.redraw(!0);break;case"rotationend":if(!e)break;e.rotate(),n.redraw(!0)}},"undefined"!=typeof o&&o.exports?o.exports=l:e.ActionTileController=l}(this.app||(this.app={}))},{"../util.js":9,"./tile-controller.js":4,mithril:void 0}],3:[function(t,o,e){!function(e){"use strict";var n=t("mithril"),r=e.util||t("../util.js"),i=e.Panel||t("../models/panel.js"),l=e.Score||t("../models/score.js"),s=function(t){var o=function(){};this.color=n.prop(t.color),this.active=n.prop(!1),this.panels=a(),this.selectedPanel=n.prop(null),this.score=n.prop(new l({red:0,yellow:0,green:0})),this.panelWidth=n.prop(72),this.onok=o,this.onback=o,this.onselect=o,this.onlayoutchange=o};s.prototype.supplyPanel=function(){for(var t=this.color(),o=this.panels(),e=0,n=o.length;n>e;e++)if(!o[e]){var r=i.sample(t);this.resetRotation(r),o[e]=r}},s.prototype.selectedIndex=function(){for(var t=this.panels(),o=this.selectedPanel(),e=0,n=t.length;n>e;e++)if(t[e]===o)return e;return-1},s.prototype.removeSelectedPanel=function(){this.panels()[this.selectedIndex()]=null,this.selectedPanel(null)},s.prototype.resetRotation=function(t){t.resetRotation(),this.layout()===s.LAYOUT_HORIZONTAL_INVERSE&&(t.rotate(),t.rotate())},s.prototype.addScore=function(t,o){this.score().add(t,o)},s.prototype.resetScore=function(){this.score().reset()},s.prototype.totalScore=function(){return this.score().total()},s.prototype.layout=function(){return r.windowAspectRatio()>=1?s.LAYOUT_VERTICAL:r.supportsTouch()&&this.color()===i.COLOR_BLACK?s.LAYOUT_HORIZONTAL_INVERSE:s.LAYOUT_HORIZONTAL},s.prototype.dispatchEvent=function(t){var o=this.active(),e=this.panels(),r=this.selectedPanel();switch(t.type){case"ok":if(!o||!r)break;this.onok();break;case"back":if(!o||!r)break;this.resetRotation(r),this.selectedPanel(null),this.onback();break;case"select":if(!o||r)break;var i=e[t.selectedIndex];this.selectedPanel(i),n.redraw(!0),this.onselect({panel:i});break;case"layoutchange":for(var l=0,s=e.length;s>l;l++){var i=e[l];i&&i!==r&&this.resetRotation(i)}this.onlayoutchange(),setTimeout(n.redraw,0)}},s.LAYOUT_VERTICAL="vertical",s.LAYOUT_HORIZONTAL="horizontal",s.LAYOUT_HORIZONTAL_INVERSE="horizontal_inverse";var a=function(){var t=n.prop([null,null,null]);return function(o){if("undefined"==typeof o)return t();for(var e=0,n=o.length;n>e;e++){var r=o[e];r&&this.resetRotation(r)}t(o)}};"undefined"!=typeof o&&o.exports?o.exports=s:e.ControlBoardController=s}(this.app||(this.app={}))},{"../models/panel.js":6,"../models/score.js":7,"../util.js":9,mithril:void 0}],4:[function(t,o,e){!function(e){"use strict";var n=t("mithril"),r=e.Panel||t("../models/panel.js"),i=e.Tile||t("../models/tile.js"),l=e.Score||t("../models/score.js"),s=function(){var t=function(){};this.tile=n.prop(new i({rowLength:8,colLength:8})),this.panelWidth=n.prop(72),this.scoreColors=n.prop([]),this.onscorechange=t,this.onscoreanimationend=t};s.prototype.panels=function(){return this.tile().panels()},s.prototype.rowLength=function(){return this.tile().rowLength()},s.prototype.colLength=function(){return this.tile().colLength()},s.prototype.panel=function(t,o,e){this.tile().panel(t,o,e)},s.prototype.canJoint=function(t,o,e){return this.tile().canJoint(t,o,e)},s.prototype.canJointAnyPosition=function(t){return this.tile().canJointAnyPosition(t)},s.prototype.reset=function(){var t=this.tile();t.reset(),t.randomEdge()},s.prototype.startScoreAnimation=function(t,o){var e=this,r=[h,p,u,d];setTimeout(function(){!function i(l){var s=r[l];if(!s)return void e.onscoreanimationend();var a=s(e,t,o,r);a&&n.redraw(!0),setTimeout(function(){n.redraw(!0),i(l+1),c(e)},a?500:0)}(0)},250)};var a=function(t,o){t.scoreColors().push(o)},c=function(t){t.scoreColors([])},h=function(t,o,e){var n=t.tile();return n.canFix(o,e)?(n.fix(o,e),a(t,{row:o,col:e,color:l.COLOR_GREEN}),t.onscorechange({red:0,yellow:0,green:1}),!0):!1},p=function(t,o,e){return t.tile().releaseColor(o,e)},u=function(t,o,e){var n=!1,r={red:0,yellow:0,green:0};return n=f(t,o,e,o-1,e,r)||n,n=f(t,o,e,o,e+1,r)||n,n=f(t,o,e,o+1,e,r)||n,n=f(t,o,e,o,e-1,r)||n,t.onscorechange(r),n},f=function(t,o,e,n,i,s){var c=t.tile(),h=c.panel(n,i);return h&&c.isJointed(o,e,n,i)?h.color()===r.COLOR_BROWN?!1:!c.canFix(n,i)||h.isFixed()?!1:(h.color()===r.COLOR_GRAY?(c.panel(n,i,null),a(t,{row:o,col:e,color:l.COLOR_RED}),s.red+=1):(c.fix(n,i),a(t,{row:n,col:i,color:l.COLOR_GREEN}),s.green+=1),!0):!1},d=function(t,o,e,n){var r=t.tile(),i=r.calcChain(o,e);if(i.length<2)return!1;var s=i.map(function(o){return function(){return o.forEach(function(o){a(t,{row:o.row,col:o.col,color:l.COLOR_YELLOW}),t.onscorechange({red:0,yellow:1,green:0})}),!0}});return Array.prototype.push.apply(n,s),!1};"undefined"!=typeof o&&o.exports?o.exports=s:e.TileController=s}(this.app||(this.app={}))},{"../models/panel.js":6,"../models/score.js":7,"../models/tile.js":8,mithril:void 0}],5:[function(t,o,e){!function(e){"use strict";var n=t("mithril"),r=e.Panel||t("../models/panel.js"),i=e.Score||t("../models/score.js"),l=function(t){this.turnPlayerColor=n.prop(t.turnPlayerColor),this.actionTileController=n.prop(t.actionTileController),this.whiteControlBoardController=n.prop(t.whiteControlBoardController),this.blackControlBoardController=n.prop(t.blackControlBoardController)};l.prototype.start=function(){h(this),p(this),u(this)};var s=function(t){var o=t.turnPlayerColor();return o===r.COLOR_WHITE?t.whiteControlBoardController():o===r.COLOR_BLACK?t.blackControlBoardController():null},a=function(t){var o=t.turnPlayerColor();return o===r.COLOR_WHITE?t.blackControlBoardController():o===r.COLOR_BLACK?t.whiteControlBoardController():null},c=function(t){var o=t.turnPlayerColor();o===r.COLOR_WHITE?t.turnPlayerColor(r.COLOR_BLACK):o===r.COLOR_BLACK&&t.turnPlayerColor(r.COLOR_WHITE)},h=function(t){var o=t.actionTileController(),e=t.whiteControlBoardController(),n=t.blackControlBoardController();o.onscorechange=v.bind(t),o.onscoreanimationend=T.bind(t),e.onok=w.bind(t),e.onback=y.bind(t),e.onselect=L.bind(t),e.onlayoutchange=C.bind(t),n.onok=e.onok,n.onback=y.bind(t),n.onselect=L.bind(t),n.onlayoutchange=C.bind(t)},p=function(t){var o=t.actionTileController(),e=s(t),n=a(t),i=e.color(),l=n.color();o.reset(),e.panels([r.sample(i),r.sample(i),r.sample(i)]),e.resetScore(),n.panels([r.sample(l),r.sample(l),null]),n.resetScore()},u=function(t){var o=s(t),e=a(t);o.active(!0),e.active(!1)},f=function(t){var o=s(t),e=a(t);o.active(!1),e.active(!1)},d=function(t){setTimeout(function(){O(t),c(t),p(t),u(t),n.redraw(!0)},500)},O=function(t){var o=t.whiteControlBoardController(),e=t.blackControlBoardController(),n="",r=o.totalScore(),i=e.totalScore();if(r===i)n+="Draw";else{var l=r>i?"white":"black";n+="The "+l+" player wins!"}n+="\n\n[Score]\nwhite: "+r+"\nblack: "+i,alert(n)},v=function(t){var o=s(this);o.addScore(i.COLOR_RED,t.red),o.addScore(i.COLOR_YELLOW,t.yellow),o.addScore(i.COLOR_GREEN,t.green)},T=function(){var t=this.actionTileController(),o=s(this),e=a(this);e.supplyPanel();var r=t.canJointAnyPosition(e.panels()),i=t.canJointAnyPosition(o.panels());r||i?(c(this),u(this)):d(this),n.redraw(!0)},w=function(){var t=this.actionTileController(),o=s(this),e=t.selectedPanel(),n=t.canJointAnyPosition(o.panels()),r=t.selectedPosition();if(e&&(n||!r)){if(!n)return t.clearSelection(),o.removeSelectedPanel(),c(this),o=s(this),o.supplyPanel(),void u(this);if(r){var i=r.row,l=r.col;t.canJoint(i,l,e)&&(f(this),t.panel(i,l,e),t.clearSelection(),o.removeSelectedPanel(),t.startScoreAnimation(i,l))}}},y=function(){var t=this.actionTileController();t.clearSelection()},L=function(t){var o=this.actionTileController();o.selectedPanel(t.panel)},C=function(){var t=this.actionTileController(),o=s(this),e=t.selectedPanel(),n=t.selectedPosition();e&&!n&&o.resetRotation(e)};"undefined"!=typeof o&&o.exports?o.exports=l:e.TurnController=l}(this.app||(this.app={}))},{"../models/panel.js":6,"../models/score.js":7,mithril:void 0}],6:[function(t,o,e){!function(e){"use strict";var n=t("mithril"),r=e.util||t("../util.js"),i=function(t){this.color=n.prop(t.color||i.COLOR_BROWN),this.jointTop=n.prop(t.jointTop||!1),this.jointRight=n.prop(t.jointRight||!1),this.jointBottom=n.prop(t.jointBottom||!1),this.jointLeft=n.prop(t.jointLeft||!1),this.isFixed=n.prop(t.isFixed||!1)};i.prototype.mixColor=function(t){var o=this.color();t===i.COLOR_WHITE?o===i.COLOR_BLACK?this.color(i.COLOR_GRAY):o===i.COLOR_GRAY&&this.color(i.COLOR_WHITE):t===i.COLOR_BLACK&&(o===i.COLOR_WHITE?this.color(i.COLOR_GRAY):o===i.COLOR_GRAY&&this.color(i.COLOR_BLACK))},i.prototype.eachJoint=function(t){this.jointTop()&&t(i.JOINT_TOP),this.jointRight()&&t(i.JOINT_RIGHT),this.jointBottom()&&t(i.JOINT_BOTTOM),this.jointLeft()&&t(i.JOINT_LEFT)},i.prototype.rotate=function(){var t=this.jointTop();this.jointTop(this.jointLeft()),this.jointLeft(this.jointBottom()),this.jointBottom(this.jointRight()),this.jointRight(t)},i.prototype.resetRotation=function(){for(var t=0;4>t;t++){for(var o=this.jointTop(),e=this.jointRight(),n=this.jointBottom(),r=this.jointLeft(),i=0,s=l.length;s>i;i++){var a=l[i];if(a.jointTop()===o&&a.jointRight()===e&&a.jointBottom()===n&&a.jointLeft()===r)return}this.rotate()}},i.prototype.clone=function(){return new i({color:this.color(),jointTop:this.jointTop(),jointRight:this.jointRight(),jointBottom:this.jointBottom(),jointLeft:this.jointLeft(),isFixed:this.isFixed()})},i.sample=function(t,o){var e,n,s,a;if(o)e=o===i.JOINT_TOP?r.randomBoolean():!1,n=o===i.JOINT_RIGHT?r.randomBoolean():!1,s=o===i.JOINT_BOTTOM?r.randomBoolean():!1,a=o===i.JOINT_LEFT?r.randomBoolean():!1;else{var c=l[Math.floor(Math.random()*l.length)];e=c.jointTop(),n=c.jointRight(),s=c.jointBottom(),a=c.jointLeft()}return new i({color:t,jointTop:e,jointRight:n,jointBottom:s,jointLeft:a})},i.COLOR_BROWN="brown",i.COLOR_WHITE="white",i.COLOR_BLACK="black",i.COLOR_GRAY="gray",i.JOINT_TOP="top",i.JOINT_RIGHT="right",i.JOINT_BOTTOM="bottom",i.JOINT_LEFT="left";var l=[new i({jointTop:!0}),new i({jointTop:!0,jointRight:!0}),new i({jointTop:!0,jointBottom:!0}),new i({jointTop:!0,jointRight:!0,jointBottom:!0}),new i({jointTop:!0,jointRight:!0,jointBottom:!0,jointLeft:!0})];"undefined"!=typeof o&&o.exports?o.exports=i:e.Panel=i}(this.app||(this.app={}))},{"../util.js":9,mithril:void 0}],7:[function(t,o,e){!function(e){"use strict";var n=t("mithril"),r=function(t){this.red=n.prop(t.red||0),this.yellow=n.prop(t.yellow||0),this.green=n.prop(t.green||0)};r.prototype.add=function(t,o){this[t](this[t]()+o)},r.prototype.reset=function(){this.red(0),this.yellow(0),this.green(0)},r.prototype.total=function(){return 100*this.red()+50*this.yellow()+300*this.green()},r.COLOR_RED="red",r.COLOR_YELLOW="yellow",r.COLOR_GREEN="green","undefined"!=typeof o&&o.exports?o.exports=r:e.Score=r}(this.app||(this.app={}))},{mithril:void 0}],8:[function(t,o,e){!function(e){"use strict";var n=t("mithril"),r=e.util||t("../util.js"),i=e.Panel||t("./panel.js"),l=function(t){this.panels=n.prop([[]]),this.rowLength=n.prop(t.rowLength||8),this.colLength=n.prop(t.colLength||8),this.reset()};l.prototype.panel=function(t,o,e){var n=this.panels();return"undefined"==typeof e?n[t][o]:void(n[t][o]=e)},l.prototype.fix=function(t,o){var e=this.panel(t,o);e.isFixed(!0)},l.prototype.canFix=function(t,o,e){var n=this.panels();if(0>=t||t>=n.length-1)return!1;if(0>=o||o>=n[0].length-1)return!1;var r=this.panel(t,o)||e,i=this.panel(t-1,o);if(r.jointTop()&&(!i||!i.jointBottom()))return!1;var l=this.panel(t,o+1);if(r.jointRight()&&(!l||!l.jointLeft()))return!1;var s=this.panel(t+1,o);if(r.jointBottom()&&(!s||!s.jointTop()))return!1;var a=this.panel(t,o-1);return!r.jointLeft()||a&&a.jointRight()?!0:!1},l.prototype.canJoint=function(t,o,e){var n=this.panels();if(0>=t||t>=n.length-1)return!1;if(0>=o||o>=n[0].length-1)return!1;var r=this.panel(t,o)||e,i=this.panel(t-1,o);if(i&&(!i.jointBottom()&&r.jointTop()||i.jointBottom()&&!r.jointTop()))return!1;var l=this.panel(t,o+1);if(l&&(!l.jointLeft()&&r.jointRight()||l.jointLeft()&&!r.jointRight()))return!1;var s=this.panel(t+1,o);if(s&&(!s.jointTop()&&r.jointBottom()||s.jointTop()&&!r.jointBottom()))return!1;var a=this.panel(t,o-1);return a&&(!a.jointRight()&&r.jointLeft()||a.jointRight()&&!r.jointLeft())?!1:!0},l.prototype.canJointAnyPosition=function(t){var o=this.panels(),e=this.rowLength(),n=this.colLength();if(0===e||0===n)return!1;if(Array.isArray(t))for(var r=0,i=t.length;i>r;r++){var l=t[r];if(l&&this.canJointAnyPosition(l))return!0}else for(var l=t.clone(),s=0;e>s;s++)for(var a=0;n>a;a++)if(!o[s][a])for(var c=0;4>c;c++){if(this.canJoint(s,a,l))return!0;l.rotate()}return!1},l.prototype.isJointed=function(t,o,e,n){return this.panel(t,o)&&this.panel(e,n)?t===e+1&&o===n&&this.panel(t,o).jointTop()&&this.panel(e,n).jointBottom()?!0:t===e&&o===n-1&&this.panel(t,o).jointRight()&&this.panel(e,n).jointLeft()?!0:t===e-1&&o===n&&this.panel(t,o).jointBottom()&&this.panel(e,n).jointTop()?!0:t===e&&o===n+1&&this.panel(t,o).jointLeft()&&this.panel(e,n).jointRight()?!0:!1:!1},l.prototype.releaseColor=function(t,o){var e=this.panel(t,o),n=e.color(),r=!1,l=this.panel(t-1,o);l&&!l.isFixed()&&l.color()!==n&&l.color()!==i.COLOR_BROWN&&l.jointBottom()&&e.jointTop()&&(l.mixColor(n),r=!0);var s=this.panel(t,o+1);s&&!s.isFixed()&&s.color()!==n&&s.color()!==i.COLOR_BROWN&&s.jointLeft()&&e.jointRight()&&(s.mixColor(n),r=!0);var a=this.panel(t+1,o);a&&!a.isFixed()&&a.color()!==n&&a.color()!==i.COLOR_BROWN&&a.jointTop()&&e.jointBottom()&&(a.mixColor(n),r=!0);var c=this.panel(t,o-1);return c&&!c.isFixed()&&c.color()!==n&&c.color()!==i.COLOR_BROWN&&c.jointRight()&&e.jointLeft()&&(c.mixColor(n),r=!0),r},l.prototype.calcChain=function(t,o){var e=this.panel(t,o);if(!e)return[];var n=e.color(),i=[[{row:t,col:o}]],l=[{row:t,col:o}],s=this;return function a(t){for(var o=i[t],e=[],c=0,h=o.length;h>c;c++){var p=o[c];s.isJointed(p.row,p.col,p.row-1,p.col)&&s.panel(p.row-1,p.col).color()===n&&e.push({row:p.row-1,col:p.col}),s.isJointed(p.row,p.col,p.row,p.col+1)&&s.panel(p.row,p.col+1).color()===n&&e.push({row:p.row,col:p.col+1}),s.isJointed(p.row,p.col,p.row+1,p.col)&&s.panel(p.row+1,p.col).color()===n&&e.push({row:p.row+1,col:p.col}),s.isJointed(p.row,p.col,p.row,p.col-1)&&s.panel(p.row,p.col-1).color()===n&&e.push({row:p.row,col:p.col-1})}e=r.uniq(e).filter(function(t){for(var o=0,e=l.length;e>o;o++){var n=l[o];if(r.isEqual(t,n))return!1}return!0}),Array.prototype.push.apply(l,e),e.length>0&&(i[t+1]=e,a(t+1))}(0),i},l.prototype.reset=function(){for(var t=this.panels(),o=this.rowLength(),e=this.colLength(),n=0;o>n;n++){t[n]=[];for(var r=0;e>r;r++)t[n][r]=null}},l.prototype.randomEdge=function(){var t=this.panels(),o=this.rowLength(),e=this.colLength();t[0][0]=new i({color:i.COLOR_BROWN}),t[0][e-1]=new i({color:i.COLOR_BROWN}),t[o-1][0]=new i({color:i.COLOR_BROWN}),t[o-1][e-1]=new i({color:i.COLOR_BROWN});for(var n=1;e-1>n;n++)t[0][n]=i.sample(i.COLOR_BROWN,i.JOINT_BOTTOM);for(var r=1;o-1>r;r++)t[r][e-1]=i.sample(i.COLOR_BROWN,i.JOINT_LEFT);for(var n=1;e-1>n;n++)t[o-1][n]=i.sample(i.COLOR_BROWN,i.JOINT_TOP);for(var r=1;o-1>r;r++)t[r][0]=i.sample(i.COLOR_BROWN,i.JOINT_RIGHT)},"undefined"!=typeof o&&o.exports?o.exports=l:e.Tile=l}(this.app||(this.app={}))},{"../util.js":9,"./panel.js":6,mithril:void 0}],9:[function(t,o,e){!function(e){"use strict";var n=t("mithril"),r={};r.randomBoolean=function(){return Math.random()<.5},r.isEqual=function(t,o){if(t===o)return!0;if(Object.keys(t).length!==Object.keys(o).length)return!1;for(var e in t)if(t[e]!==o[e])return!1;return!0},r.inherits=function(t,o){return t.super_=o,t.prototype=Object.create(o.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),t},r.uniq=function(t){for(var o=[],e=0,n=t.length;n>e;e++){for(var i=!0,l=t[e],s=0,a=o.length;a>s;s++){var c=o[s];r.isEqual(l,c)&&(i=!1)}i&&o.push(l)}return o},r.supportsTouch=function(){return"createTouch"in document},r.supportsTransitionEnd=function(){var t=document.createElement("div");return"undefined"!=typeof t.style.transition},r.windowAspectRatio=function(){return window.innerWidth/window.innerHeight},r.addResizeEvent=function(t){window.addEventListener("resize",t)},r.el=function(t){return document.querySelector(t)},r.addClass=function(t,o){t.setAttribute("class",t.getAttribute("class")+" "+o)},r.replaceClass=function(t,o,e){var n=t.getAttribute("class").replace(o,e);t.setAttribute("class",n)},r.$stageElement=n.prop(null),r.$globalToLocal=function(t){var o=r.$stageElement(),e=o.createSVGPoint();return e.x=t.x,e.y=t.y,e.matrixTransform(o.getScreenCTM().inverse())},r.$createPanelView=function(o){var r=e.panelView||t("./views/panel-view.js");return r({panel:n.prop(o.panel),x:n.prop(o.x),y:n.prop(o.y),width:n.prop(o.width)})},"undefined"!=typeof o&&o.exports?o.exports=r:e.util=r}(this.app||(this.app={}))},{"./views/panel-view.js":12,mithril:void 0}],10:[function(t,o,e){!function(e){"use strict";var n=t("mithril"),r=e.util||t("../util.js"),i=e.tileView||t("./tile-view.js"),l=function(t){var o=t.selectedPanel(),e=t.selectedPosition(),r=[],l=n.prop(null);return o&&e&&r.push(s(t,function(t){l(t.element)})),r.push(a(t,l)),[i(t),n("g.action-tile",r)]},s=function(t,o){var e=t.selectedPanel(),i=t.selectedPosition(),l=t.panelWidth(),s=t.rowLength(),a=t.colLength(),c=(i.col-a/2)*l+l/2,p=(i.row-s/2)*l+l/2;return n("g",{transform:"translate("+c+" "+p+")",config:function(e,n){if(!n){var i=e.childNodes[0];r.addClass(i,"stop"),i.addEventListener("transitionend",function(){h(t,i)}),o({element:i})}}},[r.$createPanelView({panel:e,x:0,y:0,width:l})])},a=function(t,o){var e=t.selectedPanel(),i=t.selectedPosition(),l=t.panelWidth(),s=t.rowLength(),a=t.colLength();return n("rect.hitarea",{x:-(l*a/2),y:-(l*s/2),width:l*a,height:l*s,startHandler:function(n){var r=n.clientX||n.touches[0].clientX,l=n.clientY||n.touches[0].clientY;e&&i?c(t,o()):p(t,r,l)},config:function(t,o){if(!o){var e=r.supportsTouch()?"touchstart":"mousedown";t.addEventListener(e,this.attrs.startHandler)}}})},c=function(t,o){r.supportsTransitionEnd()?r.replaceClass(o,"stop","rotate"):h(t,o)},h=function(t,o){t.dispatchEvent({type:"rotationend"}),r.replaceClass(o,"rotate","stop")},p=function(t,o,e){var n=t.panelWidth(),i=t.rowLength(),l=t.colLength(),s=r.$globalToLocal({x:o,y:e}),a=parseInt((s.y+n*i/2)/n,10),c=parseInt((s.x+n*l/2)/n,10);t.dispatchEvent({type:"select",row:a,col:c})};"undefined"!=typeof o&&o.exports?o.exports=l:e.actionTileView=l}(this.app||(this.app={}))},{"../util.js":9,"./tile-view.js":13,mithril:void 0}],11:[function(t,o,e){!function(e){"use strict";var n=t("mithril"),r=e.util||t("../util.js"),i=e.Panel||t("../models/panel.js"),l=e.ControlBoardController||t("../controllers/control-board-controller.js"),s=function(t){var o=t.color(),e=t.active(),r=t.panels(),s=t.selectedIndex(),f=t.score(),d=t.panelWidth(),v=t.layout(),T=[],w="",y=0,L=0;o===i.COLOR_WHITE?(v===l.LAYOUT_VERTICAL?y=-384:L=378,w="white"):o===i.COLOR_BLACK&&(v===l.LAYOUT_VERTICAL?y=384:L=-378,w="black");var C=function(){t.dispatchEvent({type:"ok"})},g=function(){t.dispatchEvent({type:"back"})},j=function(o){t.dispatchEvent({type:"select",selectedIndex:o.selectedIndex})};return v===l.LAYOUT_VERTICAL?(e&&T.push(a(-84+y,-312+L,168,24)),T.push(c(-84+y,-288+L,168,576)),T.push(n("g",h(-60+y,-264+L,120,42,C))),T.push(n("g",p(-60+y,-198+L,120,42,g))),T.push(u(r,s,d,-48+y,-132+L,v,j)),T.push(n("g",O(f,-36+y,180+L)))):v===l.LAYOUT_HORIZONTAL_INVERSE?(e&&T.push(a(288+y,-78+L,24,156)),T.push(c(-288+y,-78+L,576,156)),T.push(n("g.inverse",h(150+y,-54+L,120,42,C))),T.push(n("g.inverse",p(150+y,12+L,120,42,g))),T.push(u(r,s,d,-132+y,-48+L,v,j)),T.push(n("g.inverse",O(f,180+y,-36+L)))):(e&&T.push(a(-312+y,-78+L,24,156)),T.push(c(-288+y,-78+L,576,156)),T.push(n("g",h(-270+y,-54+L,120,42,C))),T.push(n("g",p(-270+y,12+L,120,42,g))),T.push(u(r,s,d,-132+y,-48+L,v,j)),T.push(n("g",O(f,180+y,-36+L)))),n("g.control-board",{className:w,config:function(o,e,n){var r=t.layout();r!==n.layout&&(t.dispatchEvent({type:"layoutchange"}),n.layout=r)}},T)},a=function(t,o,e,r){return n("rect.active",{x:t,y:o,width:e,height:r})},c=function(t,o,e,r){return n("rect.back",{x:t,y:o,width:e,height:r})},h=function(t,o,e,r,i){return n("g.button",[n("rect.rect.back",{x:t,y:o,width:e,height:r,onclick:i}),n("text.text.ok",{x:t+e/2,y:o+r/2+8},"O K")])},p=function(t,o,e,r,i){return n("g.button",[n("rect.rect.back",{x:t,y:o,width:e,height:r,onclick:i}),n("text.text.back",{x:t+e/2,y:o+r/2+6},"Back")])},u=function(t,o,e,r,i,s,a){var c,h,p=f(t,o,e,r,i,s),u=d(t,e,r,i,s,a);return s===l.LAYOUT_VERTICAL?(c=e+24,h=(e+12)*t.length+12):(c=(e+12)*t.length+12,h=e+24),n("g.slot",[n("rect.back",{x:r,y:i,width:c,height:h}),n("g",p),n("g",u)])},f=function(t,o,e,i,s,a){return t.map(function(c,h){if(!t)return null;var p={},u=o===h;return a===l.LAYOUT_VERTICAL?(p.x=i+12+e/2,p.y=s+12+(e+12)*h+e/2):a===l.LAYOUT_HORIZONTAL?(p.x=i+12+(e+12)*h+e/2,p.y=s+12+e/2):a===l.LAYOUT_HORIZONTAL_INVERSE&&(p.x=i+12+(e+12)*(t.length-h-1)+e/2,p.y=s+12+e/2),n("g",{className:u?"selected":""},[r.$createPanelView({panel:c,x:p.x,y:p.y,width:e})])})},d=function(t,o,e,i,s,a){return t.map(function(c,h){if(!t)return null;var p={};s===l.LAYOUT_VERTICAL?(p.x=e+12,p.y=i+12+(o+12)*h):s===l.LAYOUT_HORIZONTAL?(p.x=e+12+(o+12)*h,p.y=i+12):s===l.LAYOUT_HORIZONTAL_INVERSE&&(p.x=e+12+(o+12)*(t.length-h-1),p.y=i+12);var u={x:p.x,y:p.y,width:o,height:o,index:h,selectHandler:function(t){return function(){a({selectedIndex:t})}}(h),config:function(t,o){if(!o){var e=r.supportsTouch()?"touchstart":"mousedown";t.addEventListener(e,this.attrs.selectHandler)}}};return n("rect.hitarea",u)})},O=function(t,o,e){return n("g.score",[n("g.red",[n("circle.circle",{cx:o,cy:e,r:12}),n("text.text",{x:o+26,y:e+7},"×"),n("text.text",{x:o+52,y:e+7},t.red())]),n("g.yellow",[n("circle.circle",{cx:o,cy:e+34,r:12}),n("text.text",{x:o+26,y:e+41},"×"),n("text.text",{x:o+52,y:e+41},t.yellow())]),n("g.green",[n("circle.circle",{cx:o,cy:e+68,r:12}),n("text.text",{x:o+26,y:e+75},"×"),n("text.text",{x:o+52,y:e+75},t.green())])])};"undefined"!=typeof o&&o.exports?o.exports=s:e.controlBoardView=s}(this.app||(this.app={}))},{"../controllers/control-board-controller.js":3,"../models/panel.js":6,"../util.js":9,mithril:void 0}],12:[function(t,o,e){!function(e){"use strict";var n=t("mithril"),r=e.Panel||t("../models/panel.js"),i=function(t){var o=t.panel(),e=t.x(),i=t.y(),h=t.width(),p=[],u=[],f=o&&o.color()===r.COLOR_BROWN,d=!o||o.isFixed();f?u.push("edge"):o&&u.push(d?"fixed":"unfixed"),p.push(n("rect.base",{x:-(h/2)+.5,y:-(h/2)+.5,width:h-1,height:h-1}));var O="translate("+e+" "+i+")";if(!o)return n("g.panel "+u.join("."),{transform:O},p);var v=o.color();return v===r.COLOR_GRAY?u.push("gray"):v===r.COLOR_WHITE?u.push("white"):v===r.COLOR_BLACK&&u.push("black"),d||f||(o.eachJoint(function(t){p.push(l(h,t))}),p.push(n("circle.color.back",{cx:0,cy:0,r:h/3.2+3})),o.eachJoint(function(t){p.push(s(h,t))})),o.eachJoint(function(t){p.push(a(h,t)),p.push(c(h,t))}),f||p.push(n("circle.color.circle",{cx:0,cy:0,r:h/3.2})),n("g.panel "+u.join("."),{transform:O},p)},l=function(t,o){var e={width:t/4,height:t/4};switch(o){case r.JOINT_TOP:e.x=-(t/8),e.y=-(t/2);break;case r.JOINT_RIGHT:e.x=t/2-t/4,e.y=-(t/8);break;case r.JOINT_BOTTOM:e.x=-(t/8),e.y=t/4;break;case r.JOINT_LEFT:e.x=-(t/2),e.y=-(t/8)}return n("rect.joint.back.border",e)},s=function(t,o){var e={};switch(o){case r.JOINT_TOP:e.x=-(t/8)+1,e.y=-(t/2)+1,e.width=t/4-2,e.height=t/4;break;case r.JOINT_RIGHT:e.x=t/2-t/4+1,e.y=-(t/8)+1,e.width=t/4-2,e.height=t/4-2;break;case r.JOINT_BOTTOM:e.x=-(t/8)+1,e.y=t/4+1,e.width=t/4-2,e.height=t/4-2;break;case r.JOINT_LEFT:e.x=-(t/2)+1,e.y=-(t/8)+1,e.width=t/4,e.height=t/4-2}return n("rect.joint.back",e)},a=function(t,o){var e={};switch(o){case r.JOINT_TOP:e.x=-(t/8)+3,e.y=-(t/2),e.width=t/4-6,e.height=t/4+1;break;case r.JOINT_RIGHT:e.x=t/2-t/4-1,e.y=-(t/8)+3,e.width=t/4+1,e.height=t/4-6;break;case r.JOINT_BOTTOM:e.x=-(t/8)+3,e.y=t/4-1,e.width=t/4-6,e.height=t/4+1;break;case r.JOINT_LEFT:e.x=-(t/2),e.y=-(t/8)+3,e.width=t/4+1,e.height=t/4-6}return n("rect.joint.handle.border",e)},c=function(t,o){var e={};switch(o){case r.JOINT_TOP:e.x=-(t/8)+4,e.y=-(t/2)-.3,e.width=t/4-8,e.height=t/4+.3;break;case r.JOINT_RIGHT:e.x=t/2-t/4,e.y=-(t/8)+4,e.width=t/4+.3,e.height=t/4-8;break;case r.JOINT_BOTTOM:e.x=-(t/8)+4,e.y=t/4,e.width=t/4-8,e.height=t/4+.3;break;case r.JOINT_LEFT:e.x=-(t/2)-.3,e.y=-(t/8)+4,e.width=t/4,e.height=t/4-8}return n("rect.joint.handle",e)};"undefined"!=typeof o&&o.exports?o.exports=i:e.panelView=i}(this.app||(this.app={}))},{"../models/panel.js":6,mithril:void 0}],13:[function(t,o,e){!function(e){"use strict";var n=t("mithril"),r=e.util||t("../util.js"),i=function(t){var o=t.panelWidth(),e=t.scoreColors(),i=t.rowLength(),l=t.colLength();return n("g.tile",[n("rect.back",{x:-(o*l/2),y:-(o*i/2),width:o*l,height:o*i}),n("g",t.panels().map(function(t,e){return t.map(function(t,n){return r.$createPanelView({panel:t,x:-(o*l/2)+n*o+o/2,y:-(o*i/2)+e*o+o/2,width:o})})})),n("g.score-animation",e.map(function(t){return n("circle.circle",{className:t.color+(r.supportsTransitionEnd()?" animation":""),cx:(t.col-l/2)*o+o/2,cy:(t.row-i/2)*o+o/2,r:o/3.2})}))])};"undefined"!=typeof o&&o.exports?o.exports=i:e.tileView=i}(this.app||(this.app={}))},{"../util.js":9,mithril:void 0}]},{},[1]);